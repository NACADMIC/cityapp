# 🌐 프린터 서버 터널링 가이드

## Railway에서 로컬 프린터 서버 접근하기

Railway 서버는 클라우드에 있고, 로컬 PC 프린터 서버는 사설 IP에 있어서 직접 접근할 수 없습니다.
**Cloudflare Tunnel**을 사용하여 로컬 프린터 서버를 인터넷에 노출시킵니다.

## 아키텍처

```
고객 주문 → Railway 메인 서버 (클라우드)
                ↓
          Cloudflare Tunnel
                ↓
      로컬 PC 프린터 서버 (localhost:3001)
                ↓
            물리적 프린터 (COM2)
```

## 설정 방법

### 1단계: 프린터 서버 실행

1. **의존성 설치** (최초 1회)
   - `서버설치.bat` 더블클릭

2. **프린터 서버 시작**
   - `서버시작.bat` 더블클릭
   - 프린터 서버가 `http://localhost:3001`에서 실행됨

### 2단계: Cloudflare Tunnel 시작

1. **터널 시작**
   - `프린터터널시작.bat` 더블클릭
   - 터널이 시작되면 다음과 같은 URL이 표시됩니다:
     ```
     https://xxxx-xxxx-xxxx.trycloudflare.com
     ```
   - 이 URL을 복사하세요! (중요!)

2. **터널 URL 확인**
   - 콘솔 창에 표시된 `https://`로 시작하는 URL을 복사
   - 예: `https://abc123-def456.trycloudflare.com`

### 3단계: Railway 환경 변수 설정

1. **Railway 대시보드 접속**
   - 프로젝트 → 앱 서비스 선택

2. **환경 변수 추가**
   - Variables 탭 클릭
   - "+ New Variable" 클릭
   - Name: `PRINTER_SERVER_URL`
   - Value: 터널 URL (예: `https://abc123-def456.trycloudflare.com`)
   - "Add" 클릭

3. **재배포**
   - 환경 변수 추가 시 자동 재배포
   - 또는 수동으로 "Redeploy" 실행

### 4단계: 테스트

1. **Railway 서버에서 프린터 테스트**
   - POS 시스템 → 프린터 테스트
   - 또는: `https://your-app-url.railway.app/api/printer/test`

2. **로컬 프린터 서버 확인**
   - 프린터 서버 콘솔 창에서 요청 확인
   - 터널 콘솔 창에서 연결 확인

## 중요 사항

### ✅ 필수 조건
1. 프린터 서버가 실행 중이어야 함 (`서버시작.bat`)
2. 터널이 실행 중이어야 함 (`프린터터널시작.bat`)
3. Railway 환경 변수 `PRINTER_SERVER_URL` 설정 필요

### ⚠️ 주의사항
- **터널 창을 닫으면 인쇄가 안 됨!** (두 창 모두 열어둬야 함)
- 터널 URL은 매번 실행할 때마다 변경됩니다
- 터널 URL이 변경되면 Railway 환경 변수도 업데이트 필요

### 🔄 터널 URL 자동 업데이트 방법 (선택사항)
터널 URL이 자동으로 Railway에 업데이트되도록 스크립트를 만들 수 있지만,
간단하게는 터널을 시작할 때마다 URL을 복사하여 Railway에 설정하세요.

## 문제 해결

### 터널 연결 실패
- 프린터 서버가 실행 중인지 확인
- 인터넷 연결 확인
- cloudflared.exe가 있는지 확인

### 프린터 인쇄 실패
- 터널이 실행 중인지 확인
- Railway 환경 변수 확인
- 프린터 서버 콘솔 로그 확인

