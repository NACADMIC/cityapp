# 🖨️ POS PC 프린터 서버 설치 가이드

## 목표
Railway 서버에서 주문이 들어오면 → POS PC 프린터가 자동으로 인쇄

## 필요한 것
1. POS PC에 `프린터서버-독립버전` 폴더 복사
2. 설치 및 실행 (한 번만)

---

## 1단계: 파일 복사

1. `프린터서버-독립버전` 폴더 전체를 POS PC로 복사
   - USB, 네트워크 드라이브, 이메일 등으로 전송

---

## 2단계: Node.js 설치 (최초 1회)

1. https://nodejs.org 접속
2. LTS 버전 다운로드 및 설치
3. 설치 확인: 명령 프롬프트에서 `node --version`

---

## 3단계: 프린터 서버 설치

1. `프린터서버-독립버전` 폴더 열기
2. `설치.bat` 더블클릭
3. 설치 완료까지 대기 (2-3분)

---

## 4단계: 프린터 서버 시작

### 방법 A: 직접 실행 (간단하지만 매번 IP 확인 필요)

1. `시작.bat` 더블클릭
2. 콘솔 창에서 확인:
   ```
   PORT: 3001
   프린터: LKT-20 (COM2)
   통신속도: 9600 baud
   ```

3. **POS PC의 IP 주소 확인:**
   - 명령 프롬프트에서 `ipconfig` 실행
   - IPv4 주소 확인 (예: `192.168.0.100`)

4. **Railway 환경 변수 설정:**
   - Railway 대시보드 → 앱 서비스 → Variables
   - `PRINTER_SERVER_URL` 추가
   - 값: `http://192.168.0.100:3001`
   - ⚠️ 이 방법은 POS PC와 Railway 서버가 같은 네트워크에 있어야 함

### 방법 B: Cloudflare Tunnel 사용 (추천 - 어디서나 작동)

1. `cloudflared.exe` 파일을 `프린터서버-독립버전` 폴더에 복사

2. `시작.bat` 실행 (프린터 서버 시작)

3. `프린터터널시작.bat` 실행 (터널 시작)
   - 터널이 시작되면 URL이 표시됩니다:
     ```
     https://xxxx-xxxx-xxxx.trycloudflare.com
     ```
   - 이 URL을 복사하세요!

4. **Railway 환경 변수 설정:**
   - Railway 대시보드 → 앱 서비스 → Variables
   - `PRINTER_SERVER_URL` 추가
   - 값: 터널 URL (예: `https://abc123-def456.trycloudflare.com`)

---

## 5단계: 테스트

1. **Railway 서버에서 프린터 테스트:**
   - POS 시스템 → 프린터 테스트 메뉴
   - 또는: `https://your-app-url.railway.app/api/printer/test`

2. **POS PC 프린터 서버 확인:**
   - 프린터 서버 콘솔 창에서 요청 로그 확인
   - 프린터에서 인쇄되는지 확인

---

## 중요 사항

### ⚠️ 필수
- **프린터 서버 창을 항상 열어둬야 함!** (두 창: 프린터 서버 + 터널)
- 프린터 서버가 실행 중이어야 Railway에서 접근 가능
- 프린터가 COM2 포트에 연결되어 있어야 함

### 🔄 자동 시작 설정 (선택사항)
1. `시작.bat` 파일 우클릭 → 바로가기 만들기
2. 바로가기 우클릭 → 속성 → 대상에 `cmd /c` 추가
3. 시작 폴더에 바로가기 복사:
   - `Win + R` → `shell:startup` → 바로가기 복사

---

## 문제 해결

### 프린터 인쇄 안 됨
1. 프린터 서버 창이 열려있는지 확인
2. Railway 환경 변수 확인
3. 프린터 서버 콘솔 로그 확인

### Railway에서 접근 불가
- 방법 A 사용 시: POS PC와 Railway 서버가 같은 네트워크인지 확인
- 방법 B 사용 시: 터널이 실행 중인지 확인

