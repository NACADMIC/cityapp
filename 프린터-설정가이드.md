# 🖨️ 프린터 설정 가이드

## 📋 개요

LKT-20 시리얼 프린터를 사용하는 방법입니다.

## 🔧 두 가지 운영 방식

### 방식 1: 로컬 PC에서 전체 서버 실행 (간단)

**장점:**
- 설정이 간단함
- 프린터 바로 사용 가능

**단점:**
- PC가 꺼지면 서비스 중단
- 외부 접속을 위해 Cloudflare 터널 필요

**사용 방법:**
```bash
시작.bat 실행
→ [2] 외부 접속 선택
```

---

### 방식 2: 하이브리드 방식 (권장) ⭐

**구성:**
- **Railway**: 메인 서버 (주문, 결제, 데이터베이스)
- **로컬 PC**: 프린터 전용 서버 (LKT-20 프린터 연결)

**장점:**
- Railway 서버는 24시간 안정적 운영
- 프린터는 로컬 PC에서만 실행 (PC 꺼져도 주문은 계속 받음)
- 프린터만 재시작 가능

**단점:**
- 두 개의 서버를 관리해야 함

---

## 🚀 하이브리드 방식 설정

### 1단계: Railway 메인 서버 배포

1. GitHub에 코드 푸시
2. Railway에서 자동 배포
3. Railway 주소 확인 (예: `https://cityapp.up.railway.app`)

### 2단계: 로컬 PC에서 프린터 서버 실행

1. **프린터 서버 시작**
   ```bash
   프린터서버-시작.bat 실행
   ```

2. **외부 접속 설정 (Cloudflare 터널)**
   - Cloudflare 터널을 사용하여 프린터 서버를 외부에 노출
   - 또는 로컬 네트워크에서만 사용 (같은 Wi-Fi)

3. **Railway 환경 변수 설정**
   ```
   PRINTER_SERVER_URL=http://로컬PC-IP:3001
   ```
   
   또는 Cloudflare 터널 사용 시:
   ```
   PRINTER_SERVER_URL=https://프린터서버-터널주소
   ```

### 3단계: 프린터 설정 확인

**로컬 PC 환경 변수 (선택사항):**
```bash
PRINTER_SERIAL_PORT=COM2
PRINTER_BAUD_RATE=9600
```

기본값이 COM2, 9600이므로 설정하지 않아도 됩니다.

---

## 📡 프린터 서버 API

프린터 서버는 다음 엔드포인트를 제공합니다:

- `GET /test` - 프린터 테스트
- `POST /print` - 주문서 출력
- `GET /status` - 프린터 상태 확인

---

## 🔍 문제 해결

### 프린터가 작동하지 않을 때

1. **프린터 서버가 실행 중인지 확인**
   - `프린터서버-시작.bat` 실행 확인
   - 포트 3001이 열려있는지 확인

2. **COM 포트 확인**
   - Windows 장치 관리자에서 COM2 포트 확인
   - 다른 포트를 사용 중이면 환경 변수 수정

3. **통신 속도 확인**
   - LKT-20은 9600 baud 사용
   - 다른 속도가 필요하면 환경 변수 수정

4. **Railway에서 프린터 서버 연결 확인**
   - Railway 로그에서 프린터 요청 확인
   - `PRINTER_SERVER_URL` 환경 변수 확인

### 프린터 서버 연결 실패

- 로컬 네트워크에서만 사용: `PRINTER_SERVER_URL=http://로컬IP:3001`
- 외부 접속 필요: Cloudflare 터널 사용

---

## 💡 권장 사항

1. **프린터 서버는 로컬 PC에서만 실행**
   - Railway에서는 물리적 프린터 접근 불가
   - 로컬 PC에서만 COM 포트 접근 가능

2. **프린터 서버 자동 시작 설정**
   - Windows 시작 프로그램에 추가
   - 또는 작업 스케줄러로 PC 시작 시 자동 실행

3. **프린터 서버 모니터링**
   - 프린터 서버 창을 항상 확인
   - 오류 발생 시 로그 확인

---

## 📝 요약

- **Railway**: 메인 서버 (주문, 결제, DB)
- **로컬 PC**: 프린터 서버 (LKT-20 프린터)
- **연결**: Railway → HTTP 요청 → 로컬 프린터 서버 → 프린터 출력

이렇게 하면 Railway 서버는 24시간 안정적으로 운영되고, 프린터는 필요할 때만 로컬 PC에서 실행하면 됩니다!

