# 🚨 데이터 손실 긴급 확인 가이드

## 문제 상황
재배포 시 모든 데이터(가입자, 영업시간 등)가 사라짐

## 가능한 원인

### 1. Railway PostgreSQL 서비스 문제
- PostgreSQL 서비스가 삭제되고 재생성되었을 수 있음
- DATABASE_URL이 변경되었을 수 있음

### 2. 확인 방법

#### Railway 대시보드에서 확인:
1. **PostgreSQL 서비스 확인**
   - Railway 대시보드 접속
   - 프로젝트에 PostgreSQL 서비스가 별도로 있는지 확인
   - 서비스가 삭제되었다면 새로 생성됨 (데이터 손실)

2. **환경 변수 확인**
   - 앱 서비스 → Variables 탭
   - `DATABASE_URL` 값 확인
   - 값이 변경되었는지 확인

3. **데이터베이스 상태 확인**
   - 브라우저에서 `https://your-app-url.railway.app/api/admin/db-status` 접속
   - 사용자 수, 주문 수 확인

## 즉시 확인할 사항

### 1. 데이터베이스 연결 확인
```bash
# Railway 로그에서 확인
# "✅ PostgreSQL 데이터베이스 사용 (Railway)" 메시지 확인
```

### 2. 데이터베이스 상태 API 호출
브라우저에서:
```
https://your-app-url.railway.app/api/admin/db-status
```

응답 예시:
```json
{
  "database": "PostgreSQL (Railway)",
  "users": {
    "total": 0,  // ← 이게 0이면 데이터 손실
    "recent": []
  }
}
```

## 해결 방법

### 방법 1: Railway PostgreSQL 영구 저장소 확인
1. Railway 대시보드 → PostgreSQL 서비스
2. Settings → Storage 확인
3. Persistent Storage가 활성화되어 있는지 확인

### 방법 2: DATABASE_URL 확인
1. Railway 대시보드 → 앱 서비스
2. Variables 탭
3. `DATABASE_URL` 값이 올바른지 확인
4. PostgreSQL 서비스의 Connection URL과 일치하는지 확인

### 방법 3: 데이터베이스 백업 설정
Railway PostgreSQL은 자동 백업을 제공하지 않으므로:
1. 정기적으로 데이터베이스 덤프 필요
2. 또는 Railway Pro 플랜으로 업그레이드 (자동 백업 포함)

## 예방 조치

### 1. 데이터베이스 백업 스크립트 생성
```bash
# pg_dump를 사용한 백업
pg_dump $DATABASE_URL > backup.sql
```

### 2. Railway PostgreSQL 서비스 보호
- 서비스를 삭제하지 않도록 주의
- 환경 변수 변경 시 주의

## 긴급 조치

만약 데이터가 이미 손실되었다면:
1. **즉시 재배포 중단**
2. Railway 로그 확인
3. PostgreSQL 서비스 상태 확인
4. 필요시 데이터베이스 재생성 및 초기 데이터 입력

