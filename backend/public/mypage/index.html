<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ë§ˆì´ë°°ë¯¼ - ì‹œí‹°ë°˜ì </title>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #000000;
      min-height: 100vh;
      padding: 20px 20px 80px 20px;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    h2 {
      font-size: 32px;
      font-weight: 900;
      color: #FFD700;
      text-align: center;
      margin: 20px 0 30px 0;
      letter-spacing: -1px;
    }

    .back-btn, .home-btn {
      position: fixed;
      top: 20px;
      background: rgba(255, 215, 0, 0.2);
      backdrop-filter: blur(10px);
      color: #FFD700;
      border: 2px solid #FFD700;
      padding: 10px 20px;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      z-index: 10;
      transition: all 0.3s;
    }

    .back-btn {
      left: 20px;
    }

    .home-btn {
      right: 20px;
    }

    .back-btn:hover, .home-btn:hover {
      background: #FFD700;
      color: #000000;
      transform: translateY(-2px);
    }
    
    /* í¬ì¸íŠ¸ ì¹´ë“œ */
    .point-card {
      background: linear-gradient(135deg, #FFD700, #FFA500);
      border-radius: 24px;
      padding: 30px;
      margin: 20px 0;
      display: flex;
      align-items: center;
      gap: 20px;
      box-shadow: 0 8px 32px rgba(255, 215, 0, 0.4);
      animation: slideIn 0.5s ease;
    }
    
    .point-icon {
      font-size: 48px;
      animation: bounce 2s infinite;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .point-info {
      flex: 1;
    }
    
    .point-label {
      font-size: 14px;
      color: rgba(0, 0, 0, 0.7);
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .point-value {
      font-size: 32px;
      font-weight: 800;
      color: #1a1a1a;
      letter-spacing: -1px;
    }

    .user-info {
      margin-bottom: 30px;
      background: rgba(255, 215, 0, 0.1);
      padding: 20px;
      border-radius: 16px;
      border: 2px solid #FFD700;
    }
    
    /* ì„¹ì…˜ í—¤ë” */
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 40px 0 20px 0;
    }
    
    .section-header h3 {
      font-size: 20px;
      font-weight: 800;
      color: #FFD700;
    }
    
    .order-count {
      font-size: 14px;
      font-weight: 600;
      color: #000000;
      background: #FFD700;
      padding: 6px 14px;
      border-radius: 20px;
    }

    .orders-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .order-item {
      background: white;
      padding: 20px;
      border-radius: 16px;
      border: 3px solid #FFD700;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      animation: slideIn 0.3s ease;
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }

    .order-id {
      font-weight: 700;
      color: #667eea;
      font-size: 14px;
    }

    .order-date {
      font-size: 13px;
      color: #999;
    }

    .order-status {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-accepted {
      background: #d1ecf1;
      color: #0c5460;
    }

    .status-preparing {
      background: #cce5ff;
      color: #004085;
    }

    .status-delivering {
      background: #d4edda;
      color: #155724;
    }

    .status-completed {
      background: #d4edda;
      color: #155724;
    }

    .status-rejected {
      background: #f8d7da;
      color: #721c24;
    }

    .order-items {
      margin-bottom: 15px;
    }

    .order-item-detail {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      font-size: 14px;
    }

    .item-name {
      font-weight: 600;
      color: #333;
    }

    .item-quantity {
      color: #666;
      margin-right: 15px;
    }

    .item-price {
      font-weight: 700;
      color: #1a1a1a;
    }

    .order-total {
      display: flex;
      justify-content: space-between;
      padding: 15px 0;
      border-top: 2px solid #eee;
      font-size: 18px;
      font-weight: 800;
      color: #1a1a1a;
    }

    .order-actions {
      margin-top: 15px;
      display: flex;
      gap: 10px;
    }

    .order-actions button {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
    }

    .btn-track {
      background: #000000;
      color: #FFD700;
      border: 2px solid #000000;
    }

    .btn-track:hover {
      background: #FFD700;
      color: #000000;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
    }
    
    .btn-reorder {
      background: #FFD700;
      color: #000000;
      font-weight: 800;
      border: none;
    }
    
    .btn-reorder:hover {
      background: #FFC107;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
    }
    
    .btn-same-menu {
      background: transparent;
      color: #FFD700;
      border: 2px solid #FFD700;
      font-weight: 700;
    }
    
    .btn-same-menu:hover {
      background: #FFD700;
      color: #000000;
      transform: translateY(-2px);
    }

    .no-orders {
      text-align: center;
      padding: 60px 20px;
      color: #FFD700;
      font-size: 16px;
      background: rgba(255, 215, 0, 0.1);
      border-radius: 16px;
      border: 2px solid #FFD700;
    }
    
    /* í¬ì¸íŠ¸ ë‚´ì—­ */
    .point-history-item {
      background: white;
      padding: 18px;
      border-radius: 14px;
      border: 2px solid #FFD700;
      display: flex;
      justify-content: space-between;
      align-items: center;
      animation: slideIn 0.3s ease;
    }
    
    .point-history-left {
      flex: 1;
    }
    
    .point-history-type {
      font-size: 15px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 6px;
    }
    
    .point-history-date {
      font-size: 12px;
      color: #999;
    }
    
    .point-history-amount {
      font-size: 20px;
      font-weight: 800;
      text-align: right;
    }
    
    .point-history-amount.plus {
      color: #00C851;
    }
    
    .point-history-amount.minus {
      color: #FF4444;
    }
    
    /* ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ */
    .btn-logout {
      width: 100%;
      padding: 18px;
      margin: 40px 0 60px 0;
      background: transparent;
      color: #999;
      border: 2px solid #666;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .btn-logout:hover {
      background: #FF4444;
      color: white;
      border-color: #FF4444;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 68, 68, 0.4);
    }
    
    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #1a1a1a;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 8px 0 env(safe-area-inset-bottom);
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
      z-index: 1000;
      border-top: 2px solid #FFD700;
    }
    
    .nav-btn {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      padding: 8px 0;
      background: none;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      color: #FFD700;
      opacity: 0.6;
    }
    
    .nav-btn:active {
      transform: scale(0.95);
    }
    
    .nav-btn.active {
      color: #FFD700;
      opacity: 1;
    }
    
    .nav-btn.active .nav-icon {
      transform: scale(1.2);
      filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6));
    }
    
    .nav-icon {
      font-size: 22px;
      transition: all 0.3s;
      display: block;
      font-style: normal;
    }
    
    .nav-icon i {
      font-size: 22px;
    }
    
    .nav-label {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: -0.3px;
    }
  </style>
</head>
<body>
  <div class="container">
    <button class="back-btn" onclick="history.back()">â† ë’¤ë¡œ</button>
    <button class="home-btn" onclick="window.location.href='/order-new'">ğŸ  í™ˆ</button>
    
    <h2>ë§ˆì´ì‹œí‹°</h2>
    
    <!-- í¬ì¸íŠ¸ ì¹´ë“œ -->
    <div class="point-card" id="point-card" onclick="scrollToPointHistory()" style="cursor: pointer;">
      <div class="point-icon">ğŸ’°</div>
      <div class="point-info">
        <div class="point-label">ë³´ìœ  í¬ì¸íŠ¸</div>
        <div class="point-value" id="user-points">0ì›</div>
      </div>
    </div>
    
    <!-- ì‚¬ìš©ì ì •ë³´ -->
    <div id="user-info" class="user-info"></div>
    
    <!-- ì£¼ë¬¸ ë‚´ì—­ ì„¹ì…˜ -->
    <div class="section-header">
      <h3>ì£¼ë¬¸ ë‚´ì—­</h3>
      <span class="order-count" id="order-count">0ê±´</span>
    </div>
    <div id="orders-list" class="orders-list"></div>
    
    <!-- ì¿ í° ì„¹ì…˜ -->
    <div class="section-header" style="margin-top: 50px;">
      <h3>ğŸ« ë³´ìœ  ì¿ í°</h3>
      <span class="order-count" id="coupon-count">0ê°œ</span>
    </div>
    <div id="coupons-list" class="orders-list"></div>
    
    <!-- í¬ì¸íŠ¸ ë‚´ì—­ ì„¹ì…˜ -->
    <div class="section-header" style="margin-top: 50px;">
      <h3>í¬ì¸íŠ¸ ë‚´ì—­</h3>
      <span class="order-count" id="point-history-count">0ê±´</span>
    </div>
    <div id="point-history-list" class="orders-list"></div>
    
    <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
    <button class="btn-logout" onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
  </div>
  
  <!-- ë¦¬ë·° ì‘ì„± ëª¨ë‹¬ -->
  <div id="review-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 10000; align-items: center; justify-content: center;">
    <div style="background: white; border-radius: 20px; padding: 30px; max-width: 400px; width: 90%; max-height: 90vh; overflow-y: auto;">
      <h3 style="margin: 0 0 20px 0; font-size: 24px; font-weight: 800; color: #1a1a1a;">ë¦¬ë·° ì‘ì„±</h3>
      
      <input type="hidden" id="review-order-id">
      
      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">ë³„ì </label>
        <div style="display: flex; gap: 10px; justify-content: center;">
          <label style="cursor: pointer; font-size: 32px;">
            <input type="radio" name="rating" value="5" style="display: none;">
            <span style="color: #ddd;" onmouseover="this.style.color='#FFD700';" onmouseout="if(!this.previousElementSibling.checked) this.style.color='#ddd';" onclick="this.style.color='#FFD700'; document.querySelectorAll('input[name=rating]').forEach(r => r.checked = false); this.previousElementSibling.checked = true;">â­</span>
          </label>
          <label style="cursor: pointer; font-size: 32px;">
            <input type="radio" name="rating" value="4" style="display: none;">
            <span style="color: #ddd;" onmouseover="this.style.color='#FFD700';" onmouseout="if(!this.previousElementSibling.checked) this.style.color='#ddd';" onclick="this.style.color='#FFD700'; document.querySelectorAll('input[name=rating]').forEach(r => r.checked = false); this.previousElementSibling.checked = true;">â­</span>
          </label>
          <label style="cursor: pointer; font-size: 32px;">
            <input type="radio" name="rating" value="3" style="display: none;">
            <span style="color: #ddd;" onmouseover="this.style.color='#FFD700';" onmouseout="if(!this.previousElementSibling.checked) this.style.color='#ddd';" onclick="this.style.color='#FFD700'; document.querySelectorAll('input[name=rating]').forEach(r => r.checked = false); this.previousElementSibling.checked = true;">â­</span>
          </label>
          <label style="cursor: pointer; font-size: 32px;">
            <input type="radio" name="rating" value="2" style="display: none;">
            <span style="color: #ddd;" onmouseover="this.style.color='#FFD700';" onmouseout="if(!this.previousElementSibling.checked) this.style.color='#ddd';" onclick="this.style.color='#FFD700'; document.querySelectorAll('input[name=rating]').forEach(r => r.checked = false); this.previousElementSibling.checked = true;">â­</span>
          </label>
          <label style="cursor: pointer; font-size: 32px;">
            <input type="radio" name="rating" value="1" style="display: none;">
            <span style="color: #ddd;" onmouseover="this.style.color='#FFD700';" onmouseout="if(!this.previousElementSibling.checked) this.style.color='#ddd';" onclick="this.style.color='#FFD700'; document.querySelectorAll('input[name=rating]').forEach(r => r.checked = false); this.previousElementSibling.checked = true;">â­</span>
          </label>
        </div>
      </div>
      
      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">ë¦¬ë·° ë‚´ìš© (ì„ íƒ)</label>
        <textarea id="review-comment" placeholder="ìŒì‹ì´ ë§›ìˆì—ˆë‚˜ìš”? ë°°ë‹¬ì€ ë¹ ë¥´ê²Œ ì™”ë‚˜ìš”? ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”!" rows="5" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; font-family: inherit; resize: vertical;"></textarea>
      </div>
      
      <div style="display: flex; gap: 10px;">
        <button onclick="document.getElementById('review-modal').style.display='none';" style="flex: 1; padding: 12px; background: #f5f5f5; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
          ì·¨ì†Œ
        </button>
        <button onclick="submitReview()" style="flex: 1; padding: 12px; background: #FFD700; color: #000; border: none; border-radius: 8px; font-weight: 700; cursor: pointer;">
          ì‘ì„±í•˜ê¸°
        </button>
      </div>
    </div>
  </div>
  
  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <button type="button" class="nav-btn" onclick="window.location.href='/order-new'">
      <span class="nav-icon"><i class="fa-solid fa-house"></i></span>
      <span class="nav-label">í™ˆ</span>
    </button>
    <button type="button" class="nav-btn" id="nav-orders" onclick="scrollToOrders()">
      <span class="nav-icon"><i class="fa-solid fa-clipboard-list"></i></span>
      <span class="nav-label">ì£¼ë¬¸ë‚´ì—­</span>
    </button>
    <button type="button" class="nav-btn" onclick="window.location.href='/order-new'">
      <span class="nav-icon"><i class="fa-solid fa-cart-shopping"></i></span>
      <span class="nav-label">ì¥ë°”êµ¬ë‹ˆ</span>
    </button>
    <button type="button" class="nav-btn active" id="nav-profile" onclick="scrollToTop()">
      <span class="nav-icon"><i class="fa-solid fa-user"></i></span>
      <span class="nav-label">ë§ˆì´ì‹œí‹°</span>
    </button>
  </nav>

  <script>
    const statusText = {
      cancelled: 'ì·¨ì†Œë¨',
      'pending': 'ì£¼ë¬¸ ëŒ€ê¸°',
      'accepted': 'ì£¼ë¬¸ ìˆ˜ë½',
      'preparing': 'ì¡°ë¦¬ ì¤‘',
      'delivering': 'ë°°ë‹¬ ì¤‘',
      'completed': 'ë°°ë‹¬ ì™„ë£Œ',
      'rejected': 'ì£¼ë¬¸ ê±°ì ˆ'
    };

    async function fetchUserData() {
      // sessionStorageì—ì„œ currentUser ê°ì²´ ê°€ì ¸ì˜¤ê¸°
      const currentUserData = sessionStorage.getItem('currentUser');
      
      console.log('ğŸ” ì„¸ì…˜ ë°ì´í„° í™•ì¸:', currentUserData);
      
      if (!currentUserData) {
        console.log('âŒ ì„¸ì…˜ ë°ì´í„° ì—†ìŒ');
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        window.location.href = '/order-new';
        return;
      }
      
      let userId;
      try {
        const user = JSON.parse(currentUserData);
        console.log('ğŸ“¦ íŒŒì‹±ëœ ì‚¬ìš©ì ë°ì´í„°:', user);
        
        // userId ë˜ëŠ” userid ëª¨ë‘ í™•ì¸ (ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ì´)
        userId = user.userId || user.userid || user.id;
        
        console.log('ğŸ”‘ ì¶”ì¶œëœ userId:', userId);
        
        if (!userId) {
          console.error('âŒ userIdë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ. ì‚¬ìš©ì ë°ì´í„°:', user);
          alert('ë¡œê·¸ì¸ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
          sessionStorage.removeItem('currentUser');
          window.location.href = '/order-new';
          return;
        }
      } catch (e) {
        console.error('âŒ ì„¸ì…˜ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', e);
        console.error('ì›ë³¸ ë°ì´í„°:', currentUserData);
        alert('ë¡œê·¸ì¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
        sessionStorage.removeItem('currentUser');
        window.location.href = '/order-new';
        return;
      }

      try {
        // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        console.log('ğŸ“¡ API í˜¸ì¶œ:', `/api/auth/me/${userId}`);
        const userRes = await fetch(`/api/auth/me/${userId}`);
        
        console.log('ğŸ“¥ ì‘ë‹µ ìƒíƒœ:', userRes.status, userRes.statusText);
        
        // ì‘ë‹µì´ JSONì¸ì§€ í™•ì¸
        const contentType = userRes.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
          const text = await userRes.text();
          console.error('âŒ JSONì´ ì•„ë‹Œ ì‘ë‹µ:', text.substring(0, 200));
          alert('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: JSONì´ ì•„ë‹Œ ì‘ë‹µì„ ë°›ì•˜ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const userData = await userRes.json();
        console.log('ğŸ“¦ ë°›ì€ ì‚¬ìš©ì ë°ì´í„°:', userData);
        
        if (!userData.success) {
          console.error('âŒ API ì˜¤ë¥˜:', userData.error);
          console.error('âŒ ì „ì²´ ì‘ë‹µ:', userData);
          alert(`ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n${userData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
          return;
        }
        
        const user = userData.user;
        console.log('âœ… ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì„±ê³µ:', user);
        
        // í¬ì¸íŠ¸ í‘œì‹œ
        document.getElementById('user-points').textContent = 
          `${(user.points || 0).toLocaleString()}ì›`;
        
        const userInfo = document.getElementById('user-info');
        userInfo.innerHTML = `
          <div style="text-align: center; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 16px;">
            <div style="font-size: 24px; font-weight: 800; color: white; margin-bottom: 10px;">
              ${user.name}ë‹˜ ğŸ‘‹
            </div>
            <div style="font-size: 16px; color: rgba(255,255,255,0.9);">
              ğŸ“± ${user.phone}
            </div>
          </div>
        `;

        // ì£¼ë¬¸ ë‚´ì—­ ê°€ì ¸ì˜¤ê¸°
        const ordersRes = await fetch(`/api/orders/user/${userId}`);
        
        // ì‘ë‹µì´ JSONì¸ì§€ í™•ì¸
        const ordersContentType = ordersRes.headers.get('content-type');
        if (!ordersContentType || !ordersContentType.includes('application/json')) {
          const text = await ordersRes.text();
          console.error('âŒ ì£¼ë¬¸ ë‚´ì—­ JSONì´ ì•„ë‹Œ ì‘ë‹µ:', text.substring(0, 200));
          document.getElementById('orders-list').innerHTML = '<div class="no-orders">ì£¼ë¬¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
        } else {
          const ordersData = await ordersRes.json();
          
          if (!ordersData.success) {
            document.getElementById('orders-list').innerHTML = '<div class="no-orders">ì£¼ë¬¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
          } else {
            displayOrders(ordersData.orders);
          }
        }
        
        // ì¿ í° ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        try {
          const couponsRes = await fetch(`/api/coupons/user/${userId}`);
          const couponsContentType = couponsRes.headers.get('content-type');
          if (couponsContentType && couponsContentType.includes('application/json')) {
            const couponsData = await couponsRes.json();
            if (couponsData.success) {
              displayCoupons(couponsData.coupons || []);
            } else {
              document.getElementById('coupons-list').innerHTML = '<div class="no-orders">ì¿ í°ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
          } else {
            document.getElementById('coupons-list').innerHTML = '<div class="no-orders">ì¿ í°ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
          }
        } catch (couponErr) {
          console.error('ì¿ í° ë¡œë“œ ì˜¤ë¥˜:', couponErr);
          document.getElementById('coupons-list').innerHTML = '<div class="no-orders">ì¿ í°ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
        
        // í¬ì¸íŠ¸ ë‚´ì—­ ê°€ì ¸ì˜¤ê¸°
        try {
          const pointHistoryRes = await fetch(`/api/points/history/${userId}`);
          
          // ì‘ë‹µì´ JSONì¸ì§€ í™•ì¸
          const pointContentType = pointHistoryRes.headers.get('content-type');
          if (!pointContentType || !pointContentType.includes('application/json')) {
            const text = await pointHistoryRes.text();
            console.error('âŒ í¬ì¸íŠ¸ ë‚´ì—­ JSONì´ ì•„ë‹Œ ì‘ë‹µ:', text.substring(0, 200));
            document.getElementById('point-history-list').innerHTML = '<div class="no-orders">í¬ì¸íŠ¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
          } else {
            const pointHistoryData = await pointHistoryRes.json();
            
            if (pointHistoryData.success) {
              displayPointHistory(pointHistoryData.history);
            } else {
              document.getElementById('point-history-list').innerHTML = '<div class="no-orders">í¬ì¸íŠ¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
          }
        } catch (pointErr) {
          console.error('í¬ì¸íŠ¸ ë‚´ì—­ ì˜¤ë¥˜:', pointErr);
          document.getElementById('point-history-list').innerHTML = '<div class="no-orders">í¬ì¸íŠ¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
      } catch (err) {
        console.error('ì „ì²´ ì˜¤ë¥˜:', err);
        alert('ì˜¤ë¥˜: ' + err.message);
      }
    }

    function displayOrders(orders) {
      const ordersList = document.getElementById('orders-list');
      document.getElementById('order-count').textContent = `${orders.length}ê±´`;
      
      if (orders.length === 0) {
        ordersList.innerHTML = '<div class="no-orders">ì•„ì§ ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        return;
      }

      ordersList.innerHTML = orders.map(order => {
        const statusClass = `status-${order.status}`;
        const date = new Date(order.createdAt).toLocaleDateString('ko-KR', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });

        return `
          <div class="order-item">
            <div class="order-header">
              <div>
                <div class="order-id">ì£¼ë¬¸ë²ˆí˜¸: ${order.orderId}</div>
                <div class="order-date">${date}</div>
              </div>
              <span class="order-status ${statusClass}">${statusText[order.status] || order.status}</span>
            </div>
            
            <div class="order-items">
              ${order.items.map(item => `
                <div class="order-item-detail">
                  <span class="item-name">${item.name}</span>
                  <div>
                    <span class="item-quantity">x${item.quantity}</span>
                    <span class="item-price">${(item.price * item.quantity).toLocaleString()}ì›</span>
                  </div>
                </div>
              `).join('')}
            </div>
            
            <div class="order-total">
              <span>ì´ ê²°ì œê¸ˆì•¡</span>
              <span>${order.totalAmount.toLocaleString()}ì›</span>
            </div>
            
            <div class="order-actions">
              ${order.status === 'pending' ? `
                <button class="btn-cancel" onclick="cancelOrder('${order.orderId}')" style="background: #e74c3c; color: white;">
                  ì£¼ë¬¸ ì·¨ì†Œ
                </button>
                <button class="btn-edit" onclick="editOrder('${order.orderId}')" style="background: #3498db; color: white;">
                  ì£¼ë¬¸ ìˆ˜ì •
                </button>
              ` : ''}
              ${order.status === 'accepted' ? `
                <button class="btn-cancel" onclick="cancelOrder('${order.orderId}')" style="background: #e74c3c; color: white;">
                  ì£¼ë¬¸ ì·¨ì†Œ
                </button>
              ` : ''}
              ${order.status === 'completed' ? `
                <button class="btn-review" onclick="showReviewModal('${order.orderId}')" style="background: #27ae60; color: white;">
                  ë¦¬ë·° ì‘ì„±
                </button>
              ` : ''}
              <button class="btn-same-menu" onclick="reorderSameMenu('${order.orderId}')">
                ê°™ì€ ë©”ë‰´ ë‹´ê¸°
              </button>
              <button class="btn-reorder" onclick="quickReorder('${order.orderId}')">
                ë°”ë¡œ ì£¼ë¬¸
              </button>
            </div>
            <div class="order-actions" style="margin-top: 8px;">
              <button class="btn-track" onclick="window.location.href='/track?orderId=${order.orderId}'">
                ë°°ë‹¬ í˜„í™© ë³´ê¸°
              </button>
            </div>
          </div>
        `;
      }).join('');
    }
    
    function displayCoupons(coupons) {
      const container = document.getElementById('coupons-list');
      const countEl = document.getElementById('coupon-count');
      
      if (!coupons || coupons.length === 0) {
        container.innerHTML = `
          <div class="no-orders" style="text-align: center; padding: 40px 20px; color: #999;">
            <div style="font-size: 48px; margin-bottom: 15px;">ğŸ«</div>
            <p style="font-size: 16px; margin-bottom: 5px;">ë³´ìœ í•œ ì¿ í°ì´ ì—†ìŠµë‹ˆë‹¤</p>
            <p style="font-size: 13px; color: #666;">íšŒì›ê°€ì… ì‹œ ìë™ìœ¼ë¡œ ì¿ í°ì´ ë°œê¸‰ë©ë‹ˆë‹¤!</p>
          </div>
        `;
        countEl.textContent = '0ê°œ';
        return;
      }
      
      const now = new Date();
      const validCoupons = [];
      const expiredCoupons = [];
      
      coupons.forEach(coupon => {
        const validTo = new Date(coupon.validTo);
        const validFrom = new Date(coupon.validFrom);
        const isExpired = validTo < now || validFrom > now || !coupon.isActive;
        
        if (isExpired) {
          expiredCoupons.push(coupon);
        } else {
          validCoupons.push(coupon);
        }
      });
      
      let html = '';
      
      // ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í°
      if (validCoupons.length > 0) {
        validCoupons.forEach(coupon => {
          const discountText = coupon.discountType === 'fixed' 
            ? `${coupon.discountValue.toLocaleString()}ì›`
            : `${coupon.discountValue}%`;
          const minAmountText = coupon.minAmount > 0 
            ? `${coupon.minAmount.toLocaleString()}ì› ì´ìƒ ì£¼ë¬¸ ì‹œ ì‚¬ìš© ê°€ëŠ¥`
            : 'ì‚¬ìš© ê°€ëŠ¥';
          const validToDate = new Date(coupon.validTo).toLocaleDateString('ko-KR');
          
          html += `
            <div class="coupon-card">
              <div class="coupon-header">
                <div>
                  <div class="coupon-name">${coupon.name}</div>
                  <div class="coupon-code">${coupon.code}</div>
                </div>
                <div class="coupon-discount">${discountText}</div>
              </div>
              <div class="coupon-info">
                <div class="coupon-info-item">
                  <span>ìµœì†Œ ì£¼ë¬¸ê¸ˆì•¡</span>
                  <span>${coupon.minAmount > 0 ? coupon.minAmount.toLocaleString() + 'ì›' : 'ì—†ìŒ'}</span>
                </div>
                <div class="coupon-info-item">
                  <span>ìœ íš¨ê¸°ê°„</span>
                  <span>${validToDate}ê¹Œì§€</span>
                </div>
                <div class="coupon-status status-valid">ì‚¬ìš© ê°€ëŠ¥</div>
              </div>
            </div>
          `;
        });
      }
      
      // ë§Œë£Œëœ ì¿ í°
      if (expiredCoupons.length > 0) {
        expiredCoupons.forEach(coupon => {
          const discountText = coupon.discountType === 'fixed' 
            ? `${coupon.discountValue.toLocaleString()}ì›`
            : `${coupon.discountValue}%`;
          const validToDate = new Date(coupon.validTo).toLocaleDateString('ko-KR');
          
          html += `
            <div class="coupon-card expired">
              <div class="coupon-header">
                <div>
                  <div class="coupon-name">${coupon.name}</div>
                  <div class="coupon-code">${coupon.code}</div>
                </div>
                <div class="coupon-discount">${discountText}</div>
              </div>
              <div class="coupon-info">
                <div class="coupon-info-item">
                  <span>ìœ íš¨ê¸°ê°„</span>
                  <span>${validToDate}ê¹Œì§€</span>
                </div>
                <div class="coupon-status status-expired">ë§Œë£Œë¨</div>
              </div>
            </div>
          `;
        });
      }
      
      container.innerHTML = html;
      countEl.textContent = `${validCoupons.length}ê°œ${expiredCoupons.length > 0 ? ' (ë§Œë£Œ ' + expiredCoupons.length + 'ê°œ)' : ''}`;
    }
    
    function displayPointHistory(history) {
      const pointHistoryList = document.getElementById('point-history-list');
      document.getElementById('point-history-count').textContent = `${history.length}ê±´`;
      
      if (history.length === 0) {
        pointHistoryList.innerHTML = '<div class="no-orders">ì•„ì§ í¬ì¸íŠ¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        return;
      }
      
      pointHistoryList.innerHTML = history.map(item => {
        const date = new Date(item.createdAt).toLocaleDateString('ko-KR', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        const isPlus = item.amount > 0;
        const amountClass = isPlus ? 'plus' : 'minus';
        const amountPrefix = isPlus ? '+' : '';
        
        return `
          <div class="point-history-item">
            <div class="point-history-left">
              <div class="point-history-type">${item.type}</div>
              <div class="point-history-date">${date}</div>
            </div>
            <div class="point-history-amount ${amountClass}">
              ${amountPrefix}${item.amount.toLocaleString()}P
            </div>
          </div>
        `;
      }).join('');
    }
    
    // ì¬ì£¼ë¬¸ ê¸°ëŠ¥
    async function quickReorder(orderId) {
      try {
        const res = await fetch(`/api/orders/${orderId}`);
        const data = await res.json();
        
        if (!data.success || !data.order) {
          alert('ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const order = data.order;
        const items = typeof order.items === 'string' ? JSON.parse(order.items) : order.items;
        
        // ì£¼ë¬¸ í™•ì¸
        if (!confirm(`ì´ì „ ì£¼ë¬¸ê³¼ ë™ì¼í•˜ê²Œ ì£¼ë¬¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në©”ë‰´: ${items.map(i => `${i.name} x${i.quantity}`).join(', ')}\nì£¼ì†Œ: ${order.address}`)) {
          return;
        }
        
        // ì£¼ë¬¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ë©´ì„œ ì£¼ë¬¸ ì •ë³´ ì „ë‹¬
        const orderData = {
          items: items,
          address: order.address,
          phone: order.phone || order.customerphone,
          customerName: order.customerName || order.customername
        };
        
        sessionStorage.setItem('reorderData', JSON.stringify(orderData));
        window.location.href = '/order-new?reorder=true';
      } catch (error) {
        console.error('ì¬ì£¼ë¬¸ ì˜¤ë¥˜:', error);
        alert('ì¬ì£¼ë¬¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    // ê°™ì€ ë©”ë‰´ë§Œ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸°
    async function reorderSameMenu(orderId) {
      try {
        const res = await fetch(`/api/orders/${orderId}`);
        const data = await res.json();
        
        if (!data.success || !data.order) {
          alert('ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const order = data.order;
        const items = typeof order.items === 'string' ? JSON.parse(order.items) : order.items;
        
        // ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€
        sessionStorage.setItem('cartItems', JSON.stringify(items));
        alert('ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
        window.location.href = '/order-new';
      } catch (error) {
        console.error('ë©”ë‰´ ë‹´ê¸° ì˜¤ë¥˜:', error);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    function logout() {
      if (!confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      // ì„¸ì…˜ ë°ì´í„° ì‚­ì œ
      sessionStorage.removeItem('currentUser');
      localStorage.clear();
      
      alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
      window.location.href = '/order-new';
    }
    
    function scrollToOrders() {
      const ordersSection = document.querySelector('.section-header');
      if (ordersSection) {
        ordersSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
      updateNavActive('orders');
    }
    
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      updateNavActive('profile');
    }
    
    function scrollToPointHistory() {
      const pointHistorySection = document.querySelectorAll('.section-header')[1];
      if (pointHistorySection) {
        pointHistorySection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }
    
    function updateNavActive(active) {
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      
      if (active === 'orders') {
        const ordersBtn = document.getElementById('nav-orders');
        if (ordersBtn) {
          ordersBtn.classList.add('active');
        } else {
          // í´ë°±: ì¸ë±ìŠ¤ë¡œ ì°¾ê¸°
          const navBtns = document.querySelectorAll('.nav-btn');
          if (navBtns[1]) navBtns[1].classList.add('active');
        }
      } else if (active === 'profile') {
        const profileBtn = document.getElementById('nav-profile');
        if (profileBtn) {
          profileBtn.classList.add('active');
        } else {
          // í´ë°±: ì¸ë±ìŠ¤ë¡œ ì°¾ê¸°
          const navBtns = document.querySelectorAll('.nav-btn');
          if (navBtns[3]) navBtns[3].classList.add('active');
        }
      }
    }

    // ì£¼ë¬¸ ì·¨ì†Œ
    async function cancelOrder(orderId) {
      if (!confirm('ì •ë§ ì£¼ë¬¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì·¨ì†Œëœ ì£¼ë¬¸ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
        return;
      }
      
      try {
        const res = await fetch(`/api/orders/${orderId}/cancel`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ reason: 'ê³ ê° ìš”ì²­' })
        });
        
        const data = await res.json();
        if (data.success) {
          alert('ì£¼ë¬¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.\nì‚¬ìš©í•œ í¬ì¸íŠ¸ëŠ” ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
          location.reload();
        } else {
          alert(data.error || 'ì£¼ë¬¸ ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ì£¼ë¬¸ ì·¨ì†Œ ì˜¤ë¥˜:', error);
        alert('ì£¼ë¬¸ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    // ì¬ì£¼ë¬¸ (ê°™ì€ ë©”ë‰´ ë‹´ê¸°)
    function reorderSameMenu(orderId) {
      const order = ordersData.orders.find(o => o.orderId === orderId);
      if (!order) {
        alert('ì£¼ë¬¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // ì£¼ë¬¸ ì •ë³´ë¥¼ sessionStorageì— ì €ì¥í•˜ê³  ì£¼ë¬¸ í˜ì´ì§€ë¡œ ì´ë™
      sessionStorage.setItem('reorderItems', JSON.stringify(order.items));
      window.location.href = '/order-new';
    }
    
    // ë°”ë¡œ ì£¼ë¬¸ (ì¬ì£¼ë¬¸)
    async function quickReorder(orderId) {
      const order = ordersData.orders.find(o => o.orderId === orderId);
      if (!order) {
        alert('ì£¼ë¬¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // ì£¼ë¬¸ ì •ë³´ë¥¼ sessionStorageì— ì €ì¥í•˜ê³  ì£¼ë¬¸ í˜ì´ì§€ë¡œ ì´ë™
      sessionStorage.setItem('reorderItems', JSON.stringify(order.items));
      sessionStorage.setItem('quickReorder', 'true');
      window.location.href = '/order-new';
    }
    
    // ì£¼ë¬¸ ìˆ˜ì •
    async function editOrder(orderId) {
      try {
        const res = await fetch(`/api/orders/${orderId}`);
        const data = await res.json();
        
        if (!data.success || !data.order) {
          alert('ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const order = data.order;
        
        // ì ‘ìˆ˜ ì „ ìƒíƒœê°€ ì•„ë‹ˆë©´ ìˆ˜ì • ë¶ˆê°€
        if (order.status !== 'pending') {
          alert('ì£¼ë¬¸ ìˆ˜ì •ì€ ì£¼ë¬¸ ì ‘ìˆ˜ ì „ì—ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
          return;
        }
        
        // ì£¼ë¬¸ ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™ (ì£¼ë¬¸ ì •ë³´ ì „ë‹¬)
        sessionStorage.setItem('editOrderData', JSON.stringify({
          orderId: order.orderId,
          items: typeof order.items === 'string' ? JSON.parse(order.items) : order.items,
          address: order.address,
          totalAmount: order.totalAmount,
          finalAmount: order.finalAmount,
          usedPoints: order.usedPoints || 0,
          couponCode: order.couponCode || null,
          couponDiscount: order.couponDiscount || 0
        }));
        
        window.location.href = '/order-new?edit=true';
      } catch (error) {
        console.error('ì£¼ë¬¸ ìˆ˜ì • ì˜¤ë¥˜:', error);
        alert('ì£¼ë¬¸ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    // ê¸°ì¡´ editOrder í•¨ìˆ˜ (í•˜ìœ„ í˜¸í™˜ì„±)
    window.editOrder = editOrder;
      const order = ordersData.orders.find(o => o.orderId === orderId);
      if (!order) {
        alert('ì£¼ë¬¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      if (order.status !== 'pending') {
        alert('ì£¼ë¬¸ ìˆ˜ì •ì€ ì£¼ë¬¸ ì ‘ìˆ˜ ì „ì—ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        return;
      }
      
      // ì£¼ë¬¸ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ì£¼ë¬¸ í˜ì´ì§€ë¡œ ì´ë™
      sessionStorage.setItem('editOrderId', orderId);
      sessionStorage.setItem('reorderItems', JSON.stringify(order.items));
      window.location.href = '/order-new';
    }
    
    // ë¦¬ë·° ì‘ì„± ëª¨ë‹¬ í‘œì‹œ
    function showReviewModal(orderId) {
      const modal = document.getElementById('review-modal');
      if (modal) {
        document.getElementById('review-order-id').value = orderId;
        modal.style.display = 'flex';
      } else {
        alert('ë¦¬ë·° ì‘ì„± ê¸°ëŠ¥ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
      }
    }
    
    // ë¦¬ë·° ì‘ì„±
    async function submitReview() {
      const orderId = document.getElementById('review-order-id').value;
      const rating = document.querySelector('input[name="rating"]:checked')?.value;
      const comment = document.getElementById('review-comment').value.trim();
      
      if (!rating) {
        alert('ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      try {
        const user = JSON.parse(sessionStorage.getItem('currentUser'));
        const userId = user.userId || user.userid;
        const res = await fetch('/api/reviews', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            orderId,
            userId,
            rating: parseInt(rating),
            comment
          })
        });
        
        const data = await res.json();
        if (data.success) {
          alert('ë¦¬ë·°ê°€ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!');
          document.getElementById('review-modal').style.display = 'none';
          document.getElementById('review-comment').value = '';
          document.querySelectorAll('input[name="rating"]').forEach(r => r.checked = false);
        } else {
          alert(data.error || 'ë¦¬ë·° ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ë¦¬ë·° ì‘ì„± ì˜¤ë¥˜:', error);
        alert('ë¦¬ë·° ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    // URL íŒŒë¼ë¯¸í„° í™•ì¸ ë° ì´ˆê¸° íƒ­ ì„¤ì •
    function initTab() {
      const urlParams = new URLSearchParams(window.location.search);
      const tab = urlParams.get('tab');
      
      console.log('ğŸ” URL íŒŒë¼ë¯¸í„° tab:', tab);
      
      if (tab === 'orders') {
        console.log('ğŸ“¦ ì£¼ë¬¸ë‚´ì—­ íƒ­ìœ¼ë¡œ ì´ë™');
        updateNavActive('orders');
        // ë°ì´í„° ë¡œë“œ í›„ ìŠ¤í¬ë¡¤
        setTimeout(() => {
          const ordersSection = document.querySelector('.section-header');
          if (ordersSection) {
            ordersSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }, 1000);
      } else if (tab === 'points') {
        console.log('ğŸ’° í¬ì¸íŠ¸ ë‚´ì—­ íƒ­ìœ¼ë¡œ ì´ë™');
        updateNavActive('profile');
        // ë°ì´í„° ë¡œë“œ í›„ ìŠ¤í¬ë¡¤
        setTimeout(() => {
          const pointHistorySection = document.querySelectorAll('.section-header')[1];
          if (pointHistorySection) {
            pointHistorySection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }, 1000);
      } else {
        console.log('ğŸ‘¤ í”„ë¡œí•„ íƒ­ (ê¸°ë³¸)');
        // tab=profileì´ë©´ ê¸°ë³¸ (ë§¨ ìœ„)
        updateNavActive('profile');
      }
    }
    
    fetchUserData();
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ íƒ­ ì´ˆê¸°í™”
    window.addEventListener('load', function() {
      initTab();
    });
    
    // fetchUserData ì™„ë£Œ í›„ì—ë„ íƒ­ ì´ˆê¸°í™” (ë°ì´í„° ë¡œë“œ ëŒ€ê¸°)
    setTimeout(() => {
      initTab();
    }, 1200);
    
    // ê°™ì€ ë©”ë‰´ ë‹´ê¸°
    window.reorderSameMenu = async function(orderId) {
      if (!confirm('ê°™ì€ ë©”ë‰´ë¥¼ ì¥ë°”êµ¬ë‹ˆì— ë‹´ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      try {
        const res = await fetch(`/api/orders/${orderId}`);
        const data = await res.json();
        
        if (data.success) {
          const order = data.order;
          
          // ì¥ë°”êµ¬ë‹ˆì— ì•„ì´í…œ ì¶”ê°€
          const items = order.items;
          localStorage.setItem('reorder-items', JSON.stringify(items));
          
          alert('ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìŠµë‹ˆë‹¤!');
          window.location.href = '/order-new';
        } else {
          alert('ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      } catch (err) {
        alert('ì˜¤ë¥˜: ' + err.message);
      }
    };
    
    // ë°”ë¡œ ì£¼ë¬¸
    window.quickReorder = async function(orderId) {
      if (!confirm('ì´ì „ ì£¼ë¬¸ê³¼ ë™ì¼í•˜ê²Œ ë°”ë¡œ ì£¼ë¬¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      try {
        const res = await fetch(`/api/orders/${orderId}`);
        const data = await res.json();
        
        if (data.success) {
          const order = data.order;
          
          // ì¥ë°”êµ¬ë‹ˆì— ì•„ì´í…œ ì¶”ê°€í•˜ê³  ì²´í¬ì•„ì›ƒìœ¼ë¡œ ì´ë™
          const items = order.items;
          localStorage.setItem('reorder-items', JSON.stringify(items));
          localStorage.setItem('quick-checkout', 'true');
          
          window.location.href = '/order-new';
        } else {
          alert('ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      } catch (err) {
        alert('ì˜¤ë¥˜: ' + err.message);
      }
    };
  </script>
</body>
</html>

