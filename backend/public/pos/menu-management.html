<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë©”ë‰´ ê´€ë¦¬ - ì‹œí‹°ë°˜ì  POS</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .menu-management-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px;
    }
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .page-header h2 {
      font-size: 1.8em;
      color: #1976d2;
      margin: 0;
    }
    .btn-add {
      background: #4caf50;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: all 0.3s;
    }
    .btn-add:hover {
      background: #45a049;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    @media (max-width: 768px) {
      .menu-management-container {
        padding: 15px;
      }
      
      .page-header {
        margin-bottom: 20px;
      }
      
      .page-header h2 {
        font-size: 1.4em;
      }
      
      .btn-add {
        padding: 10px 18px;
        font-size: 14px;
      }
      
      .menu-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .menu-card {
        padding: 15px;
      }
      
      .menu-name {
        font-size: 1.1em;
      }
      
      .menu-actions {
        flex-direction: column;
      }
      
      .menu-actions button {
        width: 100%;
        padding: 10px;
      }
      
      .tab-btn {
        padding: 10px 16px;
        font-size: 13px;
      }
      
      .popup-content {
        max-width: 95%;
        padding: 20px;
      }
    }
    
    @media (max-width: 480px) {
      .menu-management-container {
        padding: 10px;
      }
      
      .page-header h2 {
        font-size: 1.2em;
      }
      
      .btn-add {
        padding: 8px 14px;
        font-size: 13px;
      }
      
      .menu-card {
        padding: 12px;
      }
      
      .menu-name {
        font-size: 1em;
      }
      
      .menu-price {
        font-size: 1em;
      }
    }
    .menu-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.3s;
      position: relative;
    }
    .menu-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .menu-card-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 15px;
    }
    .menu-name {
      font-size: 1.2em;
      font-weight: 600;
      color: #333;
      margin: 0;
    }
    .menu-category {
      display: inline-block;
      background: #e3f2fd;
      color: #1976d2;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
      margin-top: 8px;
    }
    .menu-price {
      font-size: 1.5em;
      font-weight: 700;
      color: #1976d2;
      margin: 10px 0;
    }
    .menu-actions {
      display: flex;
      gap: 8px;
      margin-top: 15px;
    }
    .btn-edit, .btn-delete, .btn-options, .btn-discount {
      flex: 1;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.3s;
    }
    .btn-edit {
      background: #2196f3;
      color: white;
    }
    .btn-edit:hover {
      background: #1976d2;
    }
    .btn-delete {
      background: #f44336;
      color: white;
    }
    .btn-delete:hover {
      background: #d32f2f;
    }
    .btn-options {
      background: #ff9800;
      color: white;
    }
    .btn-options:hover {
      background: #f57c00;
    }
    .btn-discount {
      background: #9c27b0;
      color: white;
    }
    .btn-discount:hover {
      background: #7b1fa2;
    }
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    .popup-content {
      background: white;
      border-radius: 12px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }
    .popup-content h3 {
      margin: 0 0 20px 0;
      color: #1976d2;
      font-size: 1.5em;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }
    .form-group input, .form-group select {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }
    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: #1976d2;
    }
    .popup-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    .popup-actions button {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
    }
    .btn-save {
      background: #4caf50;
      color: white;
    }
    .btn-cancel {
      background: #757575;
      color: white;
    }
    .options-list, .discount-info {
      margin-top: 15px;
      padding: 15px;
      background: #f5f5f5;
      border-radius: 8px;
    }
    .option-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: white;
      border-radius: 6px;
      margin-bottom: 8px;
    }
    .discount-badge {
      display: inline-block;
      background: #9c27b0;
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-left">
      <button class="hamburger-btn" onclick="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <h1 data-store-name>ğŸ® ì‹œí‹°ë°˜ì </h1>
    </div>
    <div class="header-controls">
      <a href="/pos" style="color: white; text-decoration: none; padding: 8px 14px; background: rgba(255,255,255,0.2); border-radius: 6px; font-size: 13px;">â† ì£¼ë¬¸ ê´€ë¦¬</a>
    </div>
  </div>

  <!-- ì‚¬ì´ë“œ ë©”ë‰´ -->
  <div class="side-menu" id="side-menu">
    <div class="side-menu-header">
      <h2>ğŸ“Š ë©”ë‰´</h2>
      <button class="close-btn" onclick="toggleMenu()">âœ•</button>
    </div>
    <nav class="side-menu-nav">
      <a href="/pos" class="menu-item" onclick="toggleMenu()">
        <span class="menu-icon">ğŸ“‹</span>
        <span class="menu-text">ì „ì²´í˜„í™©Â·ì„ì‹œì¤‘ì§€</span>
      </a>
      <div class="menu-divider"></div>
      <a href="javascript:void(0)" class="menu-item" onclick="alert('ê°€ê²Œê´€ë¦¬ ê¸°ëŠ¥ì€ ì£¼ë¬¸ ê´€ë¦¬ í˜ì´ì§€ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'); toggleMenu();">
        <span class="menu-icon">ğŸª</span>
        <span class="menu-text">ê°€ê²Œê´€ë¦¬</span>
      </a>
      <a href="/pos/dashboard.html" class="menu-item" onclick="toggleMenu()">
        <span class="menu-icon">ğŸ“Š</span>
        <span class="menu-text">ê°€ê²Œí†µê³„</span>
        <span class="menu-badge">ì—…ë°ì´íŠ¸</span>
      </a>
      <div class="menu-divider"></div>
      <a href="/pos/menu-management.html" class="menu-item active" onclick="toggleMenu()">
        <span class="menu-icon">ğŸ“</span>
        <span class="menu-text">ê°€ê²Œ ë©”ë‰´íŒ í¸ì§‘</span>
      </a>
      <a href="/pos/menu-management.html?tab=options" class="menu-item" onclick="toggleMenu()">
        <span class="menu-icon">âš™ï¸</span>
        <span class="menu-text">ë©”ë‰´Â·ì˜µì…˜ ê´€ë¦¬</span>
      </a>
      <a href="/pos/menu-management.html?tab=discounts" class="menu-item" onclick="toggleMenu()">
        <span class="menu-icon">ğŸ·ï¸</span>
        <span class="menu-text">ë©”ë‰´ë³„ í• ì¸ ê´€ë¦¬</span>
      </a>
      <div class="menu-divider"></div>
      <a href="/pos/dashboard.html?tab=settlement" class="menu-item" onclick="toggleMenu()">
        <span class="menu-icon">ğŸ’°</span>
        <span class="menu-text">ì •ì‚° ì •ë³´</span>
      </a>
      <a href="/pos/dashboard.html?tab=customers" class="menu-item" onclick="toggleMenu()">
        <span class="menu-icon">ğŸ‘¥</span>
        <span class="menu-text">ê³ ê° ë¶„ì„</span>
      </a>
      <a href="/pos/dashboard.html?tab=regions" class="menu-item" onclick="toggleMenu()">
        <span class="menu-icon">ğŸ“</span>
        <span class="menu-text">ì§€ì—­ ë¶„ì„</span>
      </a>
      <div class="menu-divider"></div>
      <a href="/pos/point-management.html" class="menu-item" onclick="toggleMenu()">
        <span class="menu-icon">ğŸ’°</span>
        <span class="menu-text">í¬ì¸íŠ¸ ê´€ë¦¬</span>
      </a>
      <a href="/pos/coupon-management.html" class="menu-item" onclick="toggleMenu()">
        <span class="menu-icon">ğŸ«</span>
        <span class="menu-text">ì¿ í° ê´€ë¦¬</span>
      </a>
      <a href="/pos/total-sales-management.html" class="menu-item" onclick="toggleMenu()">
        <span class="menu-icon">ğŸ“ˆ</span>
        <span class="menu-text">í†µí•© ë§¤ì¶œ ê´€ë¦¬</span>
      </a>
      <div class="menu-divider"></div>
      <a href="javascript:void(0)" class="menu-item" onclick="openSiteEditor(); toggleMenu();">
        <span class="menu-icon">ğŸ¨</span>
        <span class="menu-text">ì‚¬ì´íŠ¸ ë””ìì¸ í¸ì§‘</span>
      </a>
      <div class="menu-divider"></div>
      <a href="/pos/login.html" class="menu-item" onclick="sessionStorage.removeItem('pos-authenticated'); toggleMenu();">
        <span class="menu-icon">ğŸšª</span>
        <span class="menu-text">ë¡œê·¸ì•„ì›ƒ</span>
      </a>
    </nav>
  </div>
  
  <div class="menu-overlay" id="menu-overlay" onclick="toggleMenu()"></div>

  <div class="menu-management-container">
    <div class="page-header">
      <h2 id="page-title">ğŸ“ ê°€ê²Œ ë©”ë‰´íŒ í¸ì§‘</h2>
      <div style="display: flex; gap: 10px;">
        <button class="btn-add" id="edit-mode-btn" onclick="openEditMode()" style="background: #9c27b0;">ğŸ¨ í¸ì§‘ ëª¨ë“œ</button>
        <button class="btn-add" id="add-btn" onclick="openAddMenuPopup()" style="display: none;">+ ë©”ë‰´ ì¶”ê°€</button>
      </div>
    </div>

    <!-- íƒ­ ë©”ë‰´ -->
    <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0;">
      <button class="tab-btn" onclick="switchTab('menu')" style="padding: 12px 24px; border: none; background: none; cursor: pointer; font-size: 15px; font-weight: 600; color: #666; border-bottom: 3px solid transparent; transition: all 0.3s;">ğŸ“ ë©”ë‰´ ê´€ë¦¬</button>
      <button class="tab-btn" onclick="switchTab('options')" style="padding: 12px 24px; border: none; background: none; cursor: pointer; font-size: 15px; font-weight: 600; color: #666; border-bottom: 3px solid transparent; transition: all 0.3s;">âš™ï¸ ì˜µì…˜ ê´€ë¦¬</button>
      <button class="tab-btn" onclick="switchTab('discounts')" style="padding: 12px 24px; border: none; background: none; cursor: pointer; font-size: 15px; font-weight: 600; color: #666; border-bottom: 3px solid transparent; transition: all 0.3s;">ğŸ·ï¸ í• ì¸ ê´€ë¦¬</button>
    </div>

    <!-- ì¼ê´„ ì ìš© ì»¨íŠ¸ë¡¤ (ì˜µì…˜/í• ì¸ íƒ­ì—ì„œë§Œ í‘œì‹œ) -->
    <div id="bulk-controls" style="display: none; background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
      <h3 style="margin: 0 0 15px 0; color: #1976d2;">ì¼ê´„ ì ìš©</h3>
      <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
        <button class="btn-add" onclick="selectAllMenus()" style="background: #2196f3;">ì „ì²´ ì„ íƒ</button>
        <button class="btn-add" onclick="deselectAllMenus()" style="background: #757575;">ì „ì²´ í•´ì œ</button>
        <span id="selected-count" style="color: #666; margin-left: 10px;">ì„ íƒëœ ë©”ë‰´: 0ê°œ</span>
        <div style="margin-left: auto; display: flex; gap: 10px;">
          <button id="bulk-options-btn" class="btn-add" onclick="applyOptionsToSelected()" style="background: #ff9800; display: none;">ì„ íƒ ë©”ë‰´ì— ì˜µì…˜ ì ìš©</button>
          <button id="bulk-discount-btn" class="btn-add" onclick="applyDiscountToSelected()" style="background: #9c27b0; display: none;">ì„ íƒ ë©”ë‰´ì— í• ì¸ ì ìš©</button>
        </div>
      </div>
    </div>

    <!-- ë©”ë‰´ ê´€ë¦¬ íƒ­ -->
    <div id="menu-tab" class="tab-content">
      <div id="menu-list" class="menu-grid">
        <div style="text-align: center; padding: 40px; color: #999;">ë¡œë”© ì¤‘...</div>
      </div>
    </div>

    <!-- ì˜µì…˜ ê´€ë¦¬ íƒ­ -->
    <div id="options-tab" class="tab-content" style="display: none;">
      <div id="options-management-list" class="menu-grid">
        <div style="text-align: center; padding: 40px; color: #999;">ë¡œë”© ì¤‘...</div>
      </div>
    </div>

    <!-- í• ì¸ ê´€ë¦¬ íƒ­ -->
    <div id="discounts-tab" class="tab-content" style="display: none;">
      <div id="discounts-management-list" class="menu-grid">
        <div style="text-align: center; padding: 40px; color: #999;">ë¡œë”© ì¤‘...</div>
      </div>
    </div>
  </div>

  <!-- ë©”ë‰´ ì¶”ê°€/ìˆ˜ì • íŒì—… -->
  <div id="menu-popup" class="popup-overlay">
    <div class="popup-content">
      <h3 id="popup-title">ë©”ë‰´ ì¶”ê°€</h3>
      <form id="menu-form">
        <input type="hidden" id="menu-id">
        <div class="form-group">
          <label>ë©”ë‰´ëª… *</label>
          <input type="text" id="menu-name" required>
        </div>
        <div class="form-group">
          <label>ì¹´í…Œê³ ë¦¬</label>
          <select id="menu-category">
            <option value="ì˜¤ëŠ˜ì˜ë©”ë‰´">ì˜¤ëŠ˜ì˜ë©”ë‰´</option>
            <option value="ì¶”ì²œë©”ë‰´">ì¶”ì²œë©”ë‰´</option>
            <option value="ë©´ë¥˜">ë©´ë¥˜</option>
            <option value="ë°¥ë¥˜">ë°¥ë¥˜</option>
            <option value="ì„¸íŠ¸ë©”ë‰´">ì„¸íŠ¸ë©”ë‰´</option>
            <option value="ë””ì €íŠ¸">ë””ì €íŠ¸</option>
            <option value="ìŒë£Œ">ìŒë£Œ</option>
            <option value="ë§¥ì£¼">ë§¥ì£¼</option>
            <option value="ì†Œì£¼">ì†Œì£¼</option>
            <option value="ì£¼ë¥˜">ì£¼ë¥˜</option>
            <option value="ì‚¬ì´ë“œ">ì‚¬ì´ë“œ</option>
            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
          </select>
        </div>
        <div class="form-group">
          <label>ê°€ê²© (ì›) *</label>
          <input type="number" id="menu-price" min="0" required>
        </div>
        <div class="form-group">
          <label>ì´ë¯¸ì§€</label>
          <div style="display: flex; flex-direction: column; gap: 10px;">
            <input type="file" id="menu-image-file" accept="image/*" style="padding: 8px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;">
            <div style="font-size: 12px; color: #666;">ë˜ëŠ”</div>
            <input type="url" id="menu-image" placeholder="ì´ë¯¸ì§€ URL ì…ë ¥ (https://...)">
            <div id="image-preview" style="display: none; margin-top: 10px;">
              <img id="preview-img" src="" alt="ë¯¸ë¦¬ë³´ê¸°" style="max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid #ddd;">
            </div>
          </div>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="menu-bestseller"> ë² ìŠ¤íŠ¸ì…€ëŸ¬
          </label>
        </div>
        <div class="popup-actions">
          <button type="button" class="btn-save" onclick="saveMenu()">ì €ì¥</button>
          <button type="button" class="btn-cancel" onclick="closeMenuPopup()">ì·¨ì†Œ</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ì˜µì…˜ ê´€ë¦¬ íŒì—… -->
  <div id="options-popup" class="popup-overlay">
    <div class="popup-content">
      <h3>ë©”ë‰´ ì˜µì…˜ ê´€ë¦¬</h3>
      <div id="options-list" class="options-list"></div>
      <div class="form-group">
        <label>ì˜µì…˜ëª…</label>
        <input type="text" id="option-name" placeholder="ì˜ˆ: ì‚¬ì´ì¦ˆ ì—…">
      </div>
      <div class="form-group">
        <label>ì¶”ê°€ ê°€ê²© (ì›)</label>
        <input type="number" id="option-price" min="0" placeholder="0">
      </div>
      <button class="btn-add" onclick="addOption()" style="width: 100%; margin-bottom: 15px;">ì˜µì…˜ ì¶”ê°€</button>
      <div class="popup-actions">
        <button type="button" class="btn-save" onclick="saveOptions()">ì €ì¥</button>
        <button type="button" class="btn-cancel" onclick="closeOptionsPopup()">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- í• ì¸ ê´€ë¦¬ íŒì—… -->
  <div id="discount-popup" class="popup-overlay">
    <div class="popup-content">
      <h3>ë©”ë‰´ í• ì¸ ì„¤ì •</h3>
      <div class="form-group">
        <label>í• ì¸ íƒ€ì…</label>
        <select id="discount-type">
          <option value="">í• ì¸ ì—†ìŒ</option>
          <option value="percent">í¼ì„¼íŠ¸ í• ì¸ (%)</option>
          <option value="fixed">ê³ ì • ê¸ˆì•¡ í• ì¸ (ì›)</option>
        </select>
      </div>
      <div class="form-group">
        <label>í• ì¸ ê°’</label>
        <input type="number" id="discount-value" min="0" placeholder="ì˜ˆ: 10 (10% ë˜ëŠ” 1000ì›)">
      </div>
      <div class="popup-actions">
        <button type="button" class="btn-save" onclick="saveDiscount()">ì €ì¥</button>
        <button type="button" class="btn-cancel" onclick="closeDiscountPopup()">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <script>
    // Check authentication
    if (sessionStorage.getItem('pos-authenticated') !== 'true') {
      window.location.href = 'login.html';
    }

    let menus = [];
    let currentMenuId = null;
    let currentOptions = [];
    let discounts = {};

    // ì‚¬ì´ë“œ ë©”ë‰´ í† ê¸€
    function toggleMenu() {
      const sideMenu = document.getElementById('side-menu');
      const overlay = document.getElementById('menu-overlay');
      sideMenu.classList.toggle('active');
      overlay.classList.toggle('active');
    }

    // ë©”ë‰´ ëª©ë¡ ë¡œë“œ
    async function loadMenus() {
      try {
        const res = await fetch('/api/menu');
        const data = await res.json();
        if (data.success) {
          menus = data.menu;
          renderMenus();
          await loadDiscounts();
        }
      } catch (error) {
        console.error('ë©”ë‰´ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    // í• ì¸ ì •ë³´ ë¡œë“œ
    async function loadDiscounts() {
      try {
        const res = await fetch('/api/menu/discounts');
        const data = await res.json();
        if (data.success) {
          discounts = data.discounts || {};
          renderMenus();
        }
      } catch (error) {
        console.error('í• ì¸ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    // ë©”ë‰´ ëª©ë¡ ë Œë”ë§
    function renderMenus() {
      const container = document.getElementById('menu-list');
      if (menus.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤. ë©”ë‰´ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.</div>';
        return;
      }

      container.innerHTML = menus.map(menu => {
        const discount = discounts[menu.id];
        const discountBadge = discount 
          ? `<span class="discount-badge">${discount.type === 'percent' ? discount.value + '%' : discount.value + 'ì›'} í• ì¸</span>`
          : '';
        
        return `
          <div class="menu-card">
            <div class="menu-card-header">
              <div>
                <h3 class="menu-name">${menu.name}</h3>
                <span class="menu-category">${menu.category}</span>
                ${discountBadge}
              </div>
            </div>
            <div class="menu-price">${menu.price.toLocaleString()}ì›</div>
            <div class="menu-actions">
              <button class="btn-edit" onclick="editMenu(${menu.id})">ìˆ˜ì •</button>
              <button class="btn-options" onclick="openOptionsPopup(${menu.id})">ì˜µì…˜</button>
              <button class="btn-discount" onclick="openDiscountPopup(${menu.id})">í• ì¸</button>
              <button class="${menu.isAvailable === 0 || menu.isAvailable === false ? 'btn-available' : 'btn-soldout'}" 
                      onclick="toggleMenuAvailability(${menu.id}, ${menu.isAvailable === 0 || menu.isAvailable === false ? 1 : 0})">
                ${menu.isAvailable === 0 || menu.isAvailable === false ? 'íŒë§¤ ê°€ëŠ¥' : 'í’ˆì ˆ'}
              </button>
              <button class="btn-delete" onclick="deleteMenu(${menu.id})">ì‚­ì œ</button>
            </div>
          </div>
        `;
      }).join('');
    }

    // ë©”ë‰´ ì¶”ê°€ íŒì—… ì—´ê¸°
    function openAddMenuPopup() {
      document.getElementById('popup-title').textContent = 'ë©”ë‰´ ì¶”ê°€';
      document.getElementById('menu-id').value = '';
      document.getElementById('menu-name').value = '';
      document.getElementById('menu-category').value = 'ê¸°íƒ€';
      document.getElementById('menu-price').value = '';
      document.getElementById('menu-image').value = '';
      document.getElementById('menu-image-file').value = '';
      document.getElementById('image-preview').style.display = 'none';
      document.getElementById('menu-bestseller').checked = false;
      document.getElementById('menu-popup').style.display = 'flex';
    }

    // ë©”ë‰´ ìˆ˜ì • íŒì—… ì—´ê¸°
    async function editMenu(menuId) {
      const menu = menus.find(m => m.id === menuId);
      if (!menu) return;

      document.getElementById('popup-title').textContent = 'ë©”ë‰´ ìˆ˜ì •';
      document.getElementById('menu-id').value = menu.id;
      document.getElementById('menu-name').value = menu.name;
      document.getElementById('menu-category').value = menu.category;
      document.getElementById('menu-price').value = menu.price;
      document.getElementById('menu-image').value = menu.image || '';
      document.getElementById('menu-image-file').value = '';
      document.getElementById('image-preview').style.display = menu.image ? 'block' : 'none';
      if (menu.image) {
        document.getElementById('preview-img').src = menu.image;
      }
      document.getElementById('menu-bestseller').checked = menu.bestseller === 1;
      document.getElementById('menu-popup').style.display = 'flex';
    }

    // íŒŒì¼ ì„ íƒ ì‹œ ë¯¸ë¦¬ë³´ê¸°
    document.addEventListener('DOMContentLoaded', () => {
      const fileInput = document.getElementById('menu-image-file');
      const urlInput = document.getElementById('menu-image');
      const preview = document.getElementById('image-preview');
      const previewImg = document.getElementById('preview-img');
      
      if (fileInput) {
        fileInput.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
              previewImg.src = e.target.result;
              preview.style.display = 'block';
              urlInput.value = ''; // URL ì…ë ¥ ì´ˆê¸°í™”
            };
            reader.readAsDataURL(file);
          } else {
            preview.style.display = 'none';
          }
        });
      }
      
      if (urlInput) {
        urlInput.addEventListener('input', (e) => {
          const url = e.target.value.trim();
          if (url) {
            previewImg.src = url;
            preview.style.display = 'block';
            fileInput.value = ''; // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
          } else {
            preview.style.display = 'none';
          }
        });
      }
    });

    // ë©”ë‰´ ì €ì¥
    async function saveMenu() {
      const id = document.getElementById('menu-id').value;
      const name = document.getElementById('menu-name').value;
      const category = document.getElementById('menu-category').value;
      const price = parseInt(document.getElementById('menu-price').value);
      let image = document.getElementById('menu-image').value;
      const fileInput = document.getElementById('menu-image-file');
      const bestseller = document.getElementById('menu-bestseller').checked ? 1 : 0;

      if (!name || !price) {
        alert('ë©”ë‰´ëª…ê³¼ ê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      try {
        // íŒŒì¼ ì—…ë¡œë“œê°€ ìˆìœ¼ë©´ ë¨¼ì € ì—…ë¡œë“œ
        if (fileInput.files && fileInput.files.length > 0) {
          const formData = new FormData();
          formData.append('image', fileInput.files[0]);
          
          const uploadRes = await fetch('/api/upload/image', {
            method: 'POST',
            body: formData
          });
          
          const uploadData = await uploadRes.json();
          if (uploadData.success) {
            image = uploadData.imageUrl;
          } else {
            alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + uploadData.error);
            return;
          }
        }

        let res;
        if (id) {
          // ìˆ˜ì •
          res = await fetch(`/api/menu/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, category, price, image, bestseller })
          });
        } else {
          // ì¶”ê°€
          res = await fetch('/api/menu', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, category, price, image, bestseller })
          });
        }

        const data = await res.json();
        if (data.success) {
          alert('ë©”ë‰´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
          closeMenuPopup();
          loadMenus();
        } else {
          alert('ì €ì¥ ì‹¤íŒ¨: ' + data.error);
        }
      } catch (error) {
        alert('ì €ì¥ ì˜¤ë¥˜: ' + error.message);
      }
    }

    // ë©”ë‰´ ì‚­ì œ
    async function deleteMenu(menuId) {
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      try {
        const res = await fetch(`/api/menu/${menuId}`, { method: 'DELETE' });
        const data = await res.json();
        if (data.success) {
          alert('ë©”ë‰´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          loadMenus();
        } else {
          alert('ì‚­ì œ ì‹¤íŒ¨: ' + data.error);
        }
      } catch (error) {
        alert('ì‚­ì œ ì˜¤ë¥˜: ' + error.message);
      }
    }

    // ë©”ë‰´ íŒì—… ë‹«ê¸°
    function closeMenuPopup() {
      document.getElementById('menu-popup').style.display = 'none';
    }

    // ì˜µì…˜ ê´€ë¦¬ íŒì—… ì—´ê¸°
    async function openOptionsPopup(menuId) {
      currentMenuId = menuId;
      try {
        const res = await fetch(`/api/menu/${menuId}/options`);
        const data = await res.json();
        currentOptions = data.success ? (data.options || []) : [];
        renderOptions();
        document.getElementById('options-popup').style.display = 'flex';
      } catch (error) {
        console.error('ì˜µì…˜ ë¡œë“œ ì˜¤ë¥˜:', error);
        currentOptions = [];
        renderOptions();
        document.getElementById('options-popup').style.display = 'flex';
      }
    }

    // ì˜µì…˜ ëª©ë¡ ë Œë”ë§
    function renderOptions() {
      const container = document.getElementById('options-list');
      if (currentOptions.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 20px; color: #999;">ì˜µì…˜ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      container.innerHTML = currentOptions.map((opt, idx) => `
        <div class="option-item">
          <div>
            <strong>${opt.name}</strong>
            <span style="color: #666; margin-left: 10px;">+${opt.price.toLocaleString()}ì›</span>
          </div>
          <button onclick="removeOption(${idx})" style="background: #f44336; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">ì‚­ì œ</button>
        </div>
      `).join('');
    }

    // ì˜µì…˜ ì¶”ê°€
    function addOption() {
      const name = document.getElementById('option-name').value.trim();
      const price = parseInt(document.getElementById('option-price').value) || 0;

      if (!name) {
        alert('ì˜µì…˜ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      currentOptions.push({ name, price });
      document.getElementById('option-name').value = '';
      document.getElementById('option-price').value = '';
      renderOptions();
    }

    // ì˜µì…˜ ì‚­ì œ
    function removeOption(index) {
      currentOptions.splice(index, 1);
      renderOptions();
    }

    // ì˜µì…˜ ì €ì¥
    async function saveOptions() {
      try {
        const res = await fetch(`/api/menu/${currentMenuId}/options`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ options: currentOptions })
        });
        const data = await res.json();
        if (data.success) {
          const selectedIds = getSelectedMenuIds();
          if (selectedIds.length > 1 && selectedIds.includes(currentMenuId)) {
            // ì—¬ëŸ¬ ë©”ë‰´ê°€ ì„ íƒë˜ì–´ ìˆê³  í˜„ì¬ ë©”ë‰´ë„ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ì¼ê´„ ì ìš© ì œì•ˆ
            if (confirm('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ì„ íƒí•œ ë‹¤ë¥¸ ë©”ë‰´ë“¤ì—ë„ ê°™ì€ ì˜µì…˜ì„ ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
              await applyOptionsToSelected();
            } else {
              alert('ì˜µì…˜ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
          } else {
            alert('ì˜µì…˜ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
          }
          closeOptionsPopup();
          loadOptionsManagement();
        } else {
          alert('ì €ì¥ ì‹¤íŒ¨: ' + data.error);
        }
      } catch (error) {
        alert('ì €ì¥ ì˜¤ë¥˜: ' + error.message);
      }
    }

    // ì˜µì…˜ íŒì—… ë‹«ê¸°
    function closeOptionsPopup() {
      document.getElementById('options-popup').style.display = 'none';
      currentMenuId = null;
      currentOptions = [];
    }

    // í• ì¸ ê´€ë¦¬ íŒì—… ì—´ê¸°
    async function openDiscountPopup(menuId) {
      currentMenuId = menuId;
      const discount = discounts[menuId] || null;
      
      document.getElementById('discount-type').value = discount ? discount.type : '';
      document.getElementById('discount-value').value = discount ? discount.value : '';
      document.getElementById('discount-popup').style.display = 'flex';
    }

    // í• ì¸ ì €ì¥
    async function saveDiscount() {
      const type = document.getElementById('discount-type').value;
      const value = parseInt(document.getElementById('discount-value').value) || 0;

      if (type && value <= 0) {
        alert('í• ì¸ ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      try {
        const res = await fetch(`/api/menu/${currentMenuId}/discount`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ type: type || null, value: type ? value : null })
        });
        const data = await res.json();
        if (data.success) {
          alert('í• ì¸ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
          closeDiscountPopup();
          await loadDiscounts();
        } else {
          alert('ì €ì¥ ì‹¤íŒ¨: ' + data.error);
        }
      } catch (error) {
        alert('ì €ì¥ ì˜¤ë¥˜: ' + error.message);
      }
    }

    // í• ì¸ íŒì—… ë‹«ê¸°
    function closeDiscountPopup() {
      document.getElementById('discount-popup').style.display = 'none';
      currentMenuId = null;
    }

    // íƒ­ ì „í™˜
    function switchTab(tabName) {
      // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ ì»¨í…ì¸  ë¹„í™œì„±í™”
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.style.color = '#666';
        btn.style.borderBottomColor = 'transparent';
      });
      document.querySelectorAll('.tab-content').forEach(content => {
        content.style.display = 'none';
      });

      // ì„ íƒëœ íƒ­ í™œì„±í™”
      event.target.style.color = '#1976d2';
      event.target.style.borderBottomColor = '#1976d2';
      document.getElementById(tabName + '-tab').style.display = 'block';

      // í˜ì´ì§€ ì œëª© ë° ë²„íŠ¼ ì—…ë°ì´íŠ¸
      if (tabName === 'menu') {
        document.getElementById('page-title').textContent = 'ğŸ“ ê°€ê²Œ ë©”ë‰´íŒ í¸ì§‘';
        document.getElementById('add-btn').style.display = 'block';
        document.getElementById('add-btn').onclick = openAddMenuPopup;
        document.getElementById('bulk-controls').style.display = 'none';
        loadMenus();
      } else if (tabName === 'options') {
        document.getElementById('page-title').textContent = 'âš™ï¸ ë©”ë‰´Â·ì˜µì…˜ ê´€ë¦¬';
        document.getElementById('add-btn').style.display = 'none';
        document.getElementById('bulk-controls').style.display = 'block';
        document.getElementById('bulk-options-btn').style.display = 'block';
        document.getElementById('bulk-discount-btn').style.display = 'none';
        loadOptionsManagement();
      } else if (tabName === 'discounts') {
        document.getElementById('page-title').textContent = 'ğŸ·ï¸ ë©”ë‰´ë³„ í• ì¸ ê´€ë¦¬';
        document.getElementById('add-btn').style.display = 'none';
        document.getElementById('bulk-controls').style.display = 'block';
        document.getElementById('bulk-options-btn').style.display = 'none';
        document.getElementById('bulk-discount-btn').style.display = 'block';
        loadDiscountsManagement();
      }
    }

    // ì˜µì…˜ ê´€ë¦¬ íƒ­ ë¡œë“œ
    async function loadOptionsManagement() {
      try {
        const res = await fetch('/api/menu');
        const data = await res.json();
        if (data.success) {
          menus = data.menu;
          renderOptionsManagement();
        }
      } catch (error) {
        console.error('ë©”ë‰´ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    // ì˜µì…˜ ê´€ë¦¬ ëª©ë¡ ë Œë”ë§
    async function renderOptionsManagement() {
      const container = document.getElementById('options-management-list');
      if (menus.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      container.innerHTML = '<div style="text-align: center; padding: 20px; color: #999;">ë¡œë”© ì¤‘...</div>';

      const menuCards = [];
      for (const menu of menus) {
        try {
          const optionsRes = await fetch(`/api/menu/${menu.id}/options`);
          const optionsData = await optionsRes.json();
          const options = optionsData.success ? (optionsData.options || []) : [];
          
          menuCards.push(`
            <div class="menu-card">
              <div class="menu-card-header">
                <div style="flex: 1;">
                  <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" class="menu-checkbox" data-menu-id="${menu.id}" onchange="updateSelectedCount()" style="width: 18px; height: 18px; cursor: pointer;">
                    <div>
                      <h3 class="menu-name" style="margin: 0;">${menu.name}</h3>
                      <span class="menu-category">${menu.category}</span>
                    </div>
                  </label>
                </div>
              </div>
              <div style="margin-top: 15px;">
                ${options.length > 0 
                  ? options.map(opt => `
                    <div class="option-item" style="margin-bottom: 8px;">
                      <div>
                        <strong>${opt.name}</strong>
                        <span style="color: #666; margin-left: 10px;">+${opt.price.toLocaleString()}ì›</span>
                      </div>
                    </div>
                  `).join('')
                  : '<div style="color: #999; font-size: 14px;">ì˜µì…˜ì´ ì—†ìŠµë‹ˆë‹¤.</div>'
                }
              </div>
              <div class="menu-actions">
                <button class="btn-options" onclick="openOptionsPopup(${menu.id})" style="flex: 1;">ì˜µì…˜ ê´€ë¦¬</button>
              </div>
            </div>
          `);
        } catch (error) {
          console.error(`ë©”ë‰´ ${menu.id} ì˜µì…˜ ë¡œë“œ ì˜¤ë¥˜:`, error);
        }
      }

      container.innerHTML = menuCards.join('');
      updateSelectedCount();
    }

    // í• ì¸ ê´€ë¦¬ íƒ­ ë¡œë“œ
    async function loadDiscountsManagement() {
      try {
        const menuRes = await fetch('/api/menu');
        const menuData = await menuRes.json();
        if (menuData.success) {
          menus = menuData.menu;
        }
        await loadDiscounts();
        renderDiscountsManagement();
      } catch (error) {
        console.error('í• ì¸ ê´€ë¦¬ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    // í• ì¸ ê´€ë¦¬ ëª©ë¡ ë Œë”ë§
    function renderDiscountsManagement() {
      const container = document.getElementById('discounts-management-list');
      if (menus.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      container.innerHTML = menus.map(menu => {
        const discount = discounts[menu.id];
        const discountInfo = discount 
          ? `<div class="discount-info">
               <div style="font-weight: 600; margin-bottom: 8px;">í• ì¸ ì •ë³´</div>
               <div>íƒ€ì…: ${discount.type === 'percent' ? 'í¼ì„¼íŠ¸' : 'ê³ ì • ê¸ˆì•¡'}</div>
               <div>ê°’: ${discount.value}${discount.type === 'percent' ? '%' : 'ì›'}</div>
               <div style="margin-top: 8px; font-weight: 600; color: #9c27b0;">
                 í• ì¸ê°€: ${discount.type === 'percent' 
                   ? (menu.price * (1 - discount.value / 100)).toLocaleString() + 'ì›'
                   : Math.max(0, menu.price - discount.value).toLocaleString() + 'ì›'}
               </div>
             </div>`
          : '<div style="color: #999; font-size: 14px;">í• ì¸ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>';
        
        return `
          <div class="menu-card">
            <div class="menu-card-header">
              <div style="flex: 1;">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                  <input type="checkbox" class="menu-checkbox" data-menu-id="${menu.id}" onchange="updateSelectedCount()" style="width: 18px; height: 18px; cursor: pointer;">
                  <div>
                    <h3 class="menu-name" style="margin: 0;">${menu.name}</h3>
                    <span class="menu-category">${menu.category}</span>
                  </div>
                </label>
              </div>
            </div>
            <div class="menu-price">${menu.price.toLocaleString()}ì›</div>
            ${discountInfo}
            <div class="menu-actions">
              <button class="btn-discount" onclick="openDiscountPopup(${menu.id})" style="flex: 1;">í• ì¸ ì„¤ì •</button>
            </div>
          </div>
        `;
      }).join('');
      updateSelectedCount();
    }

    // ì„ íƒëœ ë©”ë‰´ ê°œìˆ˜ ì—…ë°ì´íŠ¸
    function updateSelectedCount() {
      const checkboxes = document.querySelectorAll('.menu-checkbox:checked');
      const count = checkboxes.length;
      document.getElementById('selected-count').textContent = `ì„ íƒëœ ë©”ë‰´: ${count}ê°œ`;
    }

    // ì „ì²´ ì„ íƒ
    function selectAllMenus() {
      document.querySelectorAll('.menu-checkbox').forEach(cb => cb.checked = true);
      updateSelectedCount();
    }

    // ì „ì²´ í•´ì œ
    function deselectAllMenus() {
      document.querySelectorAll('.menu-checkbox').forEach(cb => cb.checked = false);
      updateSelectedCount();
    }

    // ì„ íƒëœ ë©”ë‰´ ID ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
    function getSelectedMenuIds() {
      return Array.from(document.querySelectorAll('.menu-checkbox:checked'))
        .map(cb => parseInt(cb.dataset.menuId));
    }

    // ì—¬ëŸ¬ ë©”ë‰´ì— ì˜µì…˜ ì¼ê´„ ì ìš©
    async function applyOptionsToSelected() {
      const selectedIds = getSelectedMenuIds();
      if (selectedIds.length === 0) {
        alert('ì ìš©í•  ë©”ë‰´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      if (currentOptions.length === 0) {
        alert('ì ìš©í•  ì˜µì…˜ì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.');
        openOptionsPopup(selectedIds[0]);
        return;
      }

      if (!confirm(`ì„ íƒí•œ ${selectedIds.length}ê°œ ë©”ë‰´ì— ì˜µì…˜ì„ ì¼ê´„ ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
      }

      try {
        let successCount = 0;
        for (const menuId of selectedIds) {
          try {
            const res = await fetch(`/api/menu/${menuId}/options`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ options: currentOptions })
            });
            const data = await res.json();
            if (data.success) successCount++;
          } catch (error) {
            console.error(`ë©”ë‰´ ${menuId} ì˜µì…˜ ì ìš© ì˜¤ë¥˜:`, error);
          }
        }
        alert(`${successCount}ê°œ ë©”ë‰´ì— ì˜µì…˜ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        loadOptionsManagement();
      } catch (error) {
        alert('ì¼ê´„ ì ìš© ì˜¤ë¥˜: ' + error.message);
      }
    }

    // ì—¬ëŸ¬ ë©”ë‰´ì— í• ì¸ ì¼ê´„ ì ìš©
    async function applyDiscountToSelected() {
      const selectedIds = getSelectedMenuIds();
      if (selectedIds.length === 0) {
        alert('ì ìš©í•  ë©”ë‰´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      // í• ì¸ ì„¤ì • íŒì—… ì—´ê¸° (ì¼ê´„ ì ìš© ëª¨ë“œ)
      const discountType = prompt('í• ì¸ íƒ€ì…ì„ ì„ íƒí•˜ì„¸ìš”:\n1. percent (í¼ì„¼íŠ¸)\n2. fixed (ê³ ì • ê¸ˆì•¡)\n3. ì·¨ì†Œ (í• ì¸ í•´ì œ)', 'percent');
      if (!discountType || (discountType !== 'percent' && discountType !== 'fixed')) {
        if (discountType !== null) {
          // í• ì¸ í•´ì œ
          if (!confirm(`ì„ íƒí•œ ${selectedIds.length}ê°œ ë©”ë‰´ì˜ í• ì¸ì„ ëª¨ë‘ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            return;
          }
          try {
            let successCount = 0;
            for (const menuId of selectedIds) {
              try {
                const res = await fetch(`/api/menu/${menuId}/discount`, {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ type: null, value: null })
                });
                const data = await res.json();
                if (data.success) successCount++;
              } catch (error) {
                console.error(`ë©”ë‰´ ${menuId} í• ì¸ í•´ì œ ì˜¤ë¥˜:`, error);
              }
            }
            alert(`${successCount}ê°œ ë©”ë‰´ì˜ í• ì¸ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            loadDiscountsManagement();
          } catch (error) {
            alert('ì¼ê´„ í•´ì œ ì˜¤ë¥˜: ' + error.message);
          }
        }
        return;
      }

      const value = parseFloat(prompt(`í• ì¸ ê°’ì„ ì…ë ¥í•˜ì„¸ìš”:\n${discountType === 'percent' ? '(ì˜ˆ: 10 = 10%)' : '(ì˜ˆ: 1000 = 1000ì›)'}`));
      if (isNaN(value) || value <= 0) {
        alert('ì˜¬ë°”ë¥¸ ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      if (!confirm(`ì„ íƒí•œ ${selectedIds.length}ê°œ ë©”ë‰´ì— ${discountType === 'percent' ? value + '%' : value + 'ì›'} í• ì¸ì„ ì¼ê´„ ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
      }

      try {
        let successCount = 0;
        for (const menuId of selectedIds) {
          try {
            const res = await fetch(`/api/menu/${menuId}/discount`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ type: discountType, value: value })
            });
            const data = await res.json();
            if (data.success) successCount++;
          } catch (error) {
            console.error(`ë©”ë‰´ ${menuId} í• ì¸ ì ìš© ì˜¤ë¥˜:`, error);
          }
        }
        alert(`${successCount}ê°œ ë©”ë‰´ì— í• ì¸ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        loadDiscountsManagement();
      } catch (error) {
        alert('ì¼ê´„ ì ìš© ì˜¤ë¥˜: ' + error.message);
      }
    }

    // URL íŒŒë¼ë¯¸í„°ë¡œ íƒ­ ì´ˆê¸°í™”
    function initTab() {
      const urlParams = new URLSearchParams(window.location.search);
      const tab = urlParams.get('tab');
      if (tab === 'options' || tab === 'discounts') {
        // íƒ­ ë²„íŠ¼ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜
        const tabBtn = document.querySelector(`.tab-btn:nth-child(${tab === 'options' ? 2 : 3})`);
        if (tabBtn) {
          tabBtn.click();
        }
      } else {
        // ê¸°ë³¸ íƒ­ (ë©”ë‰´ ê´€ë¦¬)
        document.querySelector('.tab-btn').style.color = '#1976d2';
        document.querySelector('.tab-btn').style.borderBottomColor = '#1976d2';
        document.getElementById('add-btn').style.display = 'block';
        loadMenus();
      }
    }

        // í¸ì§‘ ëª¨ë“œ ì—´ê¸° (ìƒˆ ì°½)
        // ì‚¬ì´íŠ¸ í¸ì§‘ ëª¨ë“œ ì—´ê¸°
        function openSiteEditor() {
          const editWindow = window.open('/pos/site-editor.html', 'siteEditor', 'width=1600,height=1000,scrollbars=yes,resizable=yes');
          if (editWindow) {
            editWindow.focus();
          } else {
            alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ íŒì—…ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
          }
        }

        function openEditMode() {
          const editWindow = window.open('/pos/menu-editor.html', 'menuEditor', 'width=1400,height=900,scrollbars=yes,resizable=yes');
          if (editWindow) {
            editWindow.focus();
          } else {
            alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ íŒì—…ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
          }
        }

        // ì´ˆê¸°í™”
        initTab();
      </script>
    </body>
    </html>


