# 💬 카카오 알림톡 설정 가이드

## ✅ 구현 완료

SMS 대신 **카카오 알림톡**으로 변경되었습니다!

**장점:**
- ✅ **무료** (SMS 대비 비용 절감)
- ✅ 카카오톡으로 알림 수신
- ✅ 더 나은 사용자 경험

---

## 🔧 설정 방법

### 1단계: 카카오 비즈니스 채널 생성

1. **카카오톡 비즈니스 채널 개설**
   - https://bizmessage.kakao.com 접속
   - 카카오 계정으로 로그인
   - 비즈니스 채널 생성

2. **플러스친구 ID 확인**
   - 채널 관리 → 채널 정보에서 플러스친구 ID 확인
   - 예: `@시티반점` 또는 `_xxxxx`

---

### 2단계: 카카오 개발자 등록

1. **카카오 개발자 등록**
   - https://developers.kakao.com 접속
   - 내 애플리케이션 → 애플리케이션 추가

2. **알림톡 앱 키 발급**
   - 앱 설정 → 앱 키 확인
   - REST API 키 복사

3. **알림톡 서비스 신청**
   - 제품 설정 → 카카오 알림톡 → 서비스 신청
   - 비즈니스 채널 연결

---

### 3단계: 템플릿 등록

1. **템플릿 작성**
   - 카카오 비즈니스 채널 → 알림톡 → 템플릿 작성
   
2. **주문 접수 템플릿 예시:**
   ```
   [시티반점] 주문이 접수되었습니다.
   
   주문번호: #{주문번호}
   예상 소요시간: #{예상시간}
   
   감사합니다!
   ```
   
3. **배달 출발 템플릿 예시:**
   ```
   [시티반점] 배달이 시작되었습니다.
   
   주문번호: #{주문번호}
   곧 도착할 예정입니다.
   ```
   
4. **배달 완료 템플릿 예시:**
   ```
   [시티반점] 배달이 완료되었습니다.
   
   주문번호: #{주문번호}
   맛있게 드세요! 리뷰 작성 부탁드립니다.
   ```

5. **템플릿 승인 대기**
   - 템플릿 제출 후 카카오 승인 대기 (1-2일)
   - 승인 완료 후 템플릿 코드 확인

---

### 4단계: 환경 변수 설정

**Railway 환경 변수 추가:**

```
KAKAO_ALIMTALK_API_KEY=your_rest_api_key
KAKAO_ALIMTALK_SECRET=your_client_secret
KAKAO_PLUS_FRIEND_ID=@시티반점
KAKAO_TEMPLATE_CODE_ORDER=템플릿코드1
KAKAO_TEMPLATE_CODE_DELIVERY=템플릿코드2
KAKAO_TEMPLATE_CODE_COMPLETE=템플릿코드3
```

**테스트 모드 (실제 발송 안 함):**
```
KAKAO_TEST_MODE=true
```

---

## 📝 템플릿 변수 사용법

템플릿에서 변수를 사용하려면 `#{변수명}` 형식 사용:

```
주문번호: #{주문번호}
예상시간: #{예상시간}
```

코드에서 전달:
```javascript
{
  '#{주문번호}': 'ORD-1234567890',
  '#{예상시간}': '30-40분'
}
```

---

## 💰 비용

**카카오 알림톡:**
- **무료** (기본 제공)
- 광고성 메시지는 유료 (일반 알림은 무료)

**SMS 대비:**
- SMS: 건당 20원 → 월 18만원 (주문 100건/일 기준)
- 알림톡: **무료** → **0원**

---

## 🧪 테스트

1. **테스트 모드 활성화:**
   ```
   KAKAO_TEST_MODE=true
   ```

2. **주문 생성 후 확인:**
   - 서버 로그에서 알림톡 발송 확인
   - 카카오톡에서 알림톡 수신 확인

---

## ⚠️ 주의사항

1. **템플릿 승인 필요**
   - 템플릿은 카카오 승인 후 사용 가능
   - 승인 전까지는 테스트 모드 사용

2. **플러스친구 추가 필요**
   - 고객이 플러스친구를 추가해야 알림톡 수신 가능
   - 첫 주문 시 플러스친구 추가 안내 필요

3. **수신 거부 처리**
   - 고객이 수신 거부 시 즉시 처리
   - 법적 의무사항

---

## ✅ 완료!

카카오 알림톡으로 변경 완료! SMS 비용 없이 무료로 알림을 보낼 수 있습니다!

**다음 단계:**
1. 카카오 비즈니스 채널 생성
2. 템플릿 등록 및 승인
3. 환경 변수 설정
4. 테스트 및 운영

