# ğŸ–¨ï¸ í”„ë¦°í„° ì—°ê²° ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ì£¼ë¬¸ì´ ë“¤ì–´ì˜¤ë©´ ìë™ìœ¼ë¡œ ì£¼ë¬¸ì„œë¥¼ í”„ë¦°í„°ë¡œ ì¶œë ¥í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

## ğŸ–¨ï¸ í”„ë¦°í„° ì¢…ë¥˜

### 1. ì˜ìˆ˜ì¦ í”„ë¦°í„° (80mm)
- **ìš©ë„**: ì£¼ë¬¸ì„œ, ì˜ìˆ˜ì¦ ì¶œë ¥
- **ì˜ˆì‹œ**: ì‚¼ì„±ì „ì RP80, ì—¡ì† TM-T20, ìŠ¤íƒ€ POS-80
- **ê°€ê²©**: 10ë§Œì› ~ 30ë§Œì›

### 2. ë ˆì´ë¸” í”„ë¦°í„°
- **ìš©ë„**: ë°°ë‹¬ ë¼ë²¨ ì¶œë ¥
- **ì˜ˆì‹œ**: ë°”ì½”ë“œ ë¼ë²¨ í”„ë¦°í„°

## ğŸ”Œ ì—°ê²° ë°©ë²•

### ë°©ë²• 1: Node.js í”„ë¦°í„° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©

#### 1ë‹¨ê³„: íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
cd backend
npm install escpos escpos-usb serialport
```

- `escpos`: ESC/POS í”„ë¦°í„° ëª…ë ¹ì–´ ì²˜ë¦¬
- `escpos-usb`: USB í”„ë¦°í„° ì—°ê²°
- `serialport`: ì‹œë¦¬ì–¼ í¬íŠ¸ í”„ë¦°í„° ì—°ê²° (LKT-20 ë“±)

#### 2ë‹¨ê³„: í”„ë¦°í„° ëª¨ë“ˆ ìƒì„±

`backend/printer.js` íŒŒì¼ ìƒì„±:

```javascript
const { ThermalPrinter, PrinterTypes, CharacterSet, BreakLine } = require('node-thermal-printer');
const { escpos } = require('escpos');

class OrderPrinter {
  constructor() {
    // USB í”„ë¦°í„° ì—°ê²°
    this.printer = null;
    this.init();
  }

  async init() {
    try {
      // ë°©ë²• 1: USB í”„ë¦°í„°
      const device = new escpos.USB();
      this.printer = new escpos.Printer(device);
      
      // ë°©ë²• 2: ë„¤íŠ¸ì›Œí¬ í”„ë¦°í„°
      // const device = new escpos.Network('192.168.0.100', 9100);
      // this.printer = new escpos.Printer(device);
      
      console.log('âœ… í”„ë¦°í„° ì—°ê²° ì™„ë£Œ');
    } catch (error) {
      console.error('âŒ í”„ë¦°í„° ì—°ê²° ì‹¤íŒ¨:', error);
    }
  }

  async printOrder(orderData) {
    if (!this.printer) {
      console.error('í”„ë¦°í„°ê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
      return;
    }

    try {
      const { orderId, customerName, phone, address, items, totalAmount, paymentMethod, orderType } = orderData;
      
      // ì£¼ë¬¸ì„œ ì¸ì‡„
      this.printer
        .font('a')
        .align('ct')
        .size(1, 1)
        .text('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”')
        .text('      ì‹œí‹°ë°˜ì ')
        .text('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”')
        .text(`ì£¼ë¬¸ë²ˆí˜¸: ${orderId}`)
        .text(`ì£¼ë¬¸ì‹œê°„: ${new Date().toLocaleString('ko-KR')}`)
        .text('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”')
        .text(`ê³ ê°ëª…: ${customerName}`)
        .text(`ì „í™”ë²ˆí˜¸: ${phone}`)
        .text(`ì£¼ì†Œ: ${address}`)
        .text(`ì£¼ë¬¸íƒ€ì…: ${orderType === 'takeout' ? 'í¬ì¥' : 'ë°°ë‹¬'}`)
        .text('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”')
        .text('ì£¼ë¬¸ ë‚´ì—­')
        .text('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

      // ë©”ë‰´ ëª©ë¡
      items.forEach(item => {
        this.printer
          .text(`${item.name} x ${item.quantity}`)
          .text(`  ${(item.price * item.quantity).toLocaleString()}ì›`);
      });

      this.printer
        .text('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”')
        .text(`ì´ ê¸ˆì•¡: ${totalAmount.toLocaleString()}ì›`)
        .text(`ê²°ì œ ë°©ë²•: ${paymentMethod === 'cash' ? 'í˜„ê¸ˆ' : 'ì¹´ë“œ'}`)
        .text('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”')
        .text('ê°ì‚¬í•©ë‹ˆë‹¤!')
        .text('')
        .cut()
        .close();

      console.log('âœ… ì£¼ë¬¸ì„œ ì¸ì‡„ ì™„ë£Œ:', orderId);
    } catch (error) {
      console.error('âŒ ì¸ì‡„ ì˜¤ë¥˜:', error);
    }
  }
}

module.exports = OrderPrinter;
```

#### 3ë‹¨ê³„: ì„œë²„ì— í†µí•©

`backend/server.js`ì— ì¶”ê°€:

```javascript
const OrderPrinter = require('./printer');
const printer = new OrderPrinter();

// ì£¼ë¬¸ ìƒì„± ì‹œ í”„ë¦°í„° ì¶œë ¥
app.post('/api/orders', async (req, res) => {
  // ... ê¸°ì¡´ ì£¼ë¬¸ ìƒì„± ì½”ë“œ ...
  
  // ì£¼ë¬¸ì„œ ì¸ì‡„
  try {
    await printer.printOrder({
      orderId,
      customerName,
      phone,
      address,
      items,
      totalAmount: finalAmount,
      paymentMethod,
      orderType: orderType || 'delivery'
    });
  } catch (error) {
    console.error('í”„ë¦°í„° ì¶œë ¥ ì˜¤ë¥˜:', error);
    // í”„ë¦°í„° ì˜¤ë¥˜ëŠ” ì£¼ë¬¸ì— ì˜í–¥ ì—†ìŒ
  }
  
  // ... ë‚˜ë¨¸ì§€ ì½”ë“œ ...
});
```

### ë°©ë²• 2: ì›¹ í”„ë¦°í„° API ì‚¬ìš© (ë¸Œë¼ìš°ì € ì¸ì‡„)

#### 1ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œì— ì¸ì‡„ í•¨ìˆ˜ ì¶”ê°€

`backend/public/pos/app.js`ì— ì¶”ê°€:

```javascript
// ì£¼ë¬¸ì„œ ì¸ì‡„
function printOrder(orderData) {
  const printWindow = window.open('', '_blank');
  
  const printContent = `
    <!DOCTYPE html>
    <html>
    <head>
      <title>ì£¼ë¬¸ì„œ</title>
      <style>
        @media print {
          @page { size: 80mm auto; margin: 0; }
          body { width: 80mm; padding: 10px; font-family: monospace; }
        }
        body { width: 80mm; padding: 10px; font-family: monospace; }
        .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 10px; }
        .order-info { margin: 10px 0; }
        .items { margin: 10px 0; }
        .item { margin: 5px 0; }
        .total { border-top: 2px solid #000; padding-top: 10px; margin-top: 10px; font-weight: bold; }
        .footer { text-align: center; margin-top: 20px; }
      </style>
    </head>
    <body>
      <div class="header">
        <h2>ì‹œí‹°ë°˜ì </h2>
        <p>ì£¼ë¬¸ë²ˆí˜¸: ${orderData.orderId}</p>
        <p>${new Date().toLocaleString('ko-KR')}</p>
      </div>
      
      <div class="order-info">
        <p><strong>ê³ ê°ëª…:</strong> ${orderData.customerName}</p>
        <p><strong>ì „í™”ë²ˆí˜¸:</strong> ${orderData.phone}</p>
        <p><strong>ì£¼ì†Œ:</strong> ${orderData.address}</p>
        <p><strong>ì£¼ë¬¸íƒ€ì…:</strong> ${orderData.orderType === 'takeout' ? 'í¬ì¥' : 'ë°°ë‹¬'}</p>
      </div>
      
      <div class="items">
        <h3>ì£¼ë¬¸ ë‚´ì—­</h3>
        ${orderData.items.map(item => `
          <div class="item">
            ${item.name} x ${item.quantity} = ${(item.price * item.quantity).toLocaleString()}ì›
          </div>
        `).join('')}
      </div>
      
      <div class="total">
        <p>ì´ ê¸ˆì•¡: ${orderData.totalAmount.toLocaleString()}ì›</p>
        <p>ê²°ì œ ë°©ë²•: ${orderData.paymentMethod === 'cash' ? 'í˜„ê¸ˆ' : 'ì¹´ë“œ'}</p>
      </div>
      
      <div class="footer">
        <p>ê°ì‚¬í•©ë‹ˆë‹¤!</p>
      </div>
    </body>
    </html>
  `;
  
  printWindow.document.write(printContent);
  printWindow.document.close();
  
  setTimeout(() => {
    printWindow.print();
    printWindow.close();
  }, 250);
}
```

#### 2ë‹¨ê³„: POSì—ì„œ ì£¼ë¬¸ ìˆ˜ì‹  ì‹œ ì¸ì‡„

`backend/public/pos/app.js`ì˜ `socket.on('new-order')` ë¶€ë¶„ ìˆ˜ì •:

```javascript
socket.on('new-order', (orderData) => {
  addOrder(orderData);
  playNotificationSound();
  
  // ì£¼ë¬¸ì„œ ìë™ ì¸ì‡„
  printOrder(orderData);
});
```

## ğŸ”§ í”„ë¦°í„° ì„¤ì •

### ì‹œë¦¬ì–¼ í¬íŠ¸ í”„ë¦°í„° (LKT-20 ë“±)
1. í”„ë¦°í„°ë¥¼ ì»´í“¨í„°ì— ì‹œë¦¬ì–¼ ì¼€ì´ë¸”ë¡œ ì—°ê²°
2. Windows: ì¥ì¹˜ ê´€ë¦¬ìì—ì„œ COM í¬íŠ¸ í™•ì¸ (ì˜ˆ: COM2)
3. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •:
   ```bash
   PRINTER_SERIAL_PORT=COM2
   PRINTER_BAUD_RATE=9600
   ```
4. ë˜ëŠ” `backend/printer.js`ì—ì„œ ê¸°ë³¸ê°’ ì‚¬ìš© (COM2, 9600)

### USB í”„ë¦°í„°
1. í”„ë¦°í„°ë¥¼ ì»´í“¨í„°ì— USBë¡œ ì—°ê²°
2. ë“œë¼ì´ë²„ ì„¤ì¹˜
3. Windows: ì¥ì¹˜ ê´€ë¦¬ìì—ì„œ Vendor IDì™€ Product ID í™•ì¸
4. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •:
   ```bash
   PRINTER_VENDOR_ID=0x04f9
   PRINTER_PRODUCT_ID=0x2042
   ```

### ë„¤íŠ¸ì›Œí¬ í”„ë¦°í„°
1. í”„ë¦°í„°ë¥¼ ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°
2. IP ì£¼ì†Œ í™•ì¸ (ì˜ˆ: 192.168.0.100)
3. í¬íŠ¸ ë²ˆí˜¸ í™•ì¸ (ê¸°ë³¸: 9100)
4. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •:
   ```bash
   PRINTER_IP=192.168.0.100
   PRINTER_PORT=9100
   ```

## ğŸ“ ì£¼ë¬¸ì„œ í˜•ì‹ ì˜ˆì‹œ

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      ì‹œí‹°ë°˜ì 
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì£¼ë¬¸ë²ˆí˜¸: ORD-1234567890
ì£¼ë¬¸ì‹œê°„: 2024-01-15 12:30:45
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ê³ ê°ëª…: í™ê¸¸ë™
ì „í™”ë²ˆí˜¸: 010-1234-5678
ì£¼ì†Œ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123
ì£¼ë¬¸íƒ€ì…: ë°°ë‹¬
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì£¼ë¬¸ ë‚´ì—­
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì§œì¥ë©´ x 2
  12,000ì›
íƒ•ìˆ˜ìœ¡ x 1
  15,000ì›
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì´ ê¸ˆì•¡: 27,000ì›
ê²°ì œ ë°©ë²•: ì¹´ë“œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ê°ì‚¬í•©ë‹ˆë‹¤!
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **í”„ë¦°í„° ë“œë¼ì´ë²„**: í”„ë¦°í„° ì œì¡°ì‚¬ì—ì„œ ì œê³µí•˜ëŠ” ë“œë¼ì´ë²„ ì„¤ì¹˜ í•„ìš”
2. **ê¶Œí•œ ë¬¸ì œ**: Windowsì—ì„œ COM í¬íŠ¸ ì ‘ê·¼ ê¶Œí•œ í•„ìš”
3. **ë„¤íŠ¸ì›Œí¬ ë°©í™”ë²½**: ë„¤íŠ¸ì›Œí¬ í”„ë¦°í„° ì‚¬ìš© ì‹œ ë°©í™”ë²½ ì„¤ì • í™•ì¸
4. **ìš©ì§€ í¬ê¸°**: 80mm ì˜ìˆ˜ì¦ ìš©ì§€ ì‚¬ìš© ê¶Œì¥

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

1. í”„ë¦°í„° ì—°ê²° í™•ì¸
2. í…ŒìŠ¤íŠ¸ ì£¼ë¬¸ ìƒì„±
3. ì£¼ë¬¸ì„œ ì¶œë ¥ í™•ì¸
4. ë‹¤ì–‘í•œ ì£¼ë¬¸ íƒ€ì… í…ŒìŠ¤íŠ¸ (ë°°ë‹¬/í¬ì¥)

## ğŸ“ ë¬¸ì˜

- í”„ë¦°í„° ì œì¡°ì‚¬ ê³ ê°ì„¼í„°
- ê°œë°œì ì»¤ë®¤ë‹ˆí‹°: Stack Overflow, GitHub

