# 🛡️ 회원 데이터 삭제 방지 가이드

## ✅ 수정 완료 사항

### 1. SQLite 테이블 삭제 로직 비활성화
- 개발 모드에서도 테이블을 삭제하지 않도록 수정
- 데이터 보존을 위해 삭제 로직 완전 제거

### 2. PostgreSQL은 원래 안전
- PostgreSQL (`database-pg-complete.js`)에는 데이터 삭제 로직이 없음
- `CREATE TABLE IF NOT EXISTS`만 사용하여 안전

---

## 🔍 데이터 삭제 원인 분석

### 코드상 문제: 없음 ✅
- PostgreSQL: 데이터 삭제 로직 없음
- SQLite: 삭제 로직 비활성화 완료

### 가능한 원인 (Railway 설정 문제)

#### 1. 데이터베이스 서비스 재생성
- Railway에서 PostgreSQL 서비스를 삭제하고 새로 만든 경우
- **해결**: 데이터베이스 서비스를 절대 삭제하지 마세요

#### 2. 환경 변수 변경
- `DATABASE_URL`이 다른 데이터베이스를 가리키는 경우
- **해결**: Railway → Variables에서 `DATABASE_URL` 확인

#### 3. 데이터베이스 수동 리셋
- Railway에서 데이터베이스를 수동으로 리셋한 경우
- **해결**: 리셋 기능 사용 금지

---

## 🛡️ 데이터 보존 보장 방법

### 1. Railway 설정 확인

#### PostgreSQL 서비스 확인
1. Railway 대시보드 접속
2. 프로젝트 선택
3. **PostgreSQL 서비스** 확인
4. 서비스가 **하나만** 있는지 확인

#### 환경 변수 확인
1. Railway → **Variables** 탭
2. `DATABASE_URL` 확인
3. 값이 변경되지 않았는지 확인

### 2. 데이터베이스 서비스 삭제 금지
- ⚠️ **절대 삭제하지 마세요**
- 삭제하면 모든 데이터가 사라집니다
- 백업도 함께 사라집니다

### 3. 정기 백업
1. Railway → PostgreSQL → **Data** → **Backup**
2. 주기적으로 백업 다운로드 (일주일마다 권장)
3. 백업 파일 안전한 곳에 보관

---

## 🔧 현재 상태 확인

### 서버 로그 확인
Railway → **Deployments** → **View Logs**에서:
- "✅ PostgreSQL 데이터베이스 사용 (Railway)" 확인
- "✅ 메뉴 이미 존재" 또는 "✅ 메뉴 초기화 완료" 확인
- 데이터베이스 연결 오류 없음 확인

### 데이터 확인
```
https://[서비스URL]/api/admin/db-status
```

---

## ⚠️ 주의사항

### 절대 하지 말아야 할 것
1. ❌ PostgreSQL 서비스 삭제
2. ❌ 데이터베이스 리셋
3. ❌ `DATABASE_URL` 환경 변수 삭제
4. ❌ 여러 PostgreSQL 서비스 생성 (혼란 방지)

### 해도 되는 것
1. ✅ 코드 배포 (데이터 보존됨)
2. ✅ 서비스 재시작 (데이터 보존됨)
3. ✅ 환경 변수 추가 (데이터 보존됨)

---

## 🚨 문제 발생 시

### 데이터가 사라진 경우
1. Railway 백업 확인
2. 데이터베이스 서비스 상태 확인
3. 환경 변수 확인
4. 서버 로그 확인

### 데이터 복구
1. Railway → PostgreSQL → **Data** → **Backups**
2. 백업 파일 다운로드
3. 복원

---

## ✅ 최종 확인

### 코드 수정 완료
- [x] SQLite 테이블 삭제 로직 비활성화
- [x] PostgreSQL은 원래 안전 (삭제 로직 없음)
- [x] 데이터 보존 로직 확인

### Railway 설정 확인 필요
- [ ] PostgreSQL 서비스가 하나만 있는지 확인
- [ ] `DATABASE_URL` 환경 변수 확인
- [ ] 데이터베이스 서비스 삭제하지 않았는지 확인

---

**이제 코드상으로는 데이터가 삭제되지 않습니다! 🛡️**

Railway 설정만 확인하면 됩니다!

